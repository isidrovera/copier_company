<odoo>
    <data>
        <template id="inherit_form_template" inherit_id="website_helpdesk.ticket_submit_form">
            <xpath expr="//div[@id='helpdesk_section']" position="inside">
                <div class="form-group">
                    <label for="maquina_selector">Máquina</label>
                    <select id="maquina_selector" name="maquina_id" class="form-control">
                        <!-- Las opciones se llenarán dinámicamente con JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="serie_text">Serie</label>
                    <input type="text" id="serie_text" name="serie_id" class="form-control" readonly/>
                </div>
            </xpath>
            <xpath expr="//div[@id='helpdesk_section']" position="after">
                <script type="text/javascript">
                    $(document).ready(function() {
                        var maquinasData = {};
                        $.getJSON('/get_maquinas', function(data) {
                            var select = $('#maquina_selector');
                            // Asegúrate de que el select esté vacío antes de agregar nuevas opciones
                            select.empty();
                            $.each(data, function(index, value) {
                                maquinasData[value.id] = value.serie;
                                select.append(new Option(value.name, value.id));
                            });
                        });

                        $('#maquina_selector').change(function() {
                            var maquinaId = $(this).val();
                            var serie = maquinasData[maquinaId] || '';
                            $('#serie_text').val(serie);
                        });
                    });
                </script>
            </xpath>
        </template>
    </data>
</odoo>
