<?xml version="1.0" encoding="utf-8"?>
<odoo>
<!-- ============================================================
     NUEVO TEMPLATE: LISTA DE SERVICIOS DEL EQUIPO
     ============================================================ -->
<template id="portal_my_copier_equipment_services" name="Equipment Services History">
    <t t-call="portal.portal_layout">
        <t t-set="breadcrumbs_searchbar" t-value="True"/>
        
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap');
            @import url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css');
            
            .services-hero {
                background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
                color: white;
                border-radius: 0 0 30px 30px;
                margin: -20px -15px 30px;
                padding: 40px 15px;
            }
            
            .service-card {
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                border: 2px solid #f1f5f9;
                margin-bottom: 20px;
                transition: all 0.3s ease;
                cursor: pointer;
            }
            
            .service-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 40px rgba(0,0,0,0.12);
                border-color: #8b5cf6;
            }
            
            .service-header {
                background: linear-gradient(135deg, #fafafa, #f3f4f6);
                padding: 20px;
                border-bottom: 2px solid #e5e7eb;
            }
            
            .service-body { padding: 20px; }
            
            .service-footer {
                background: #f9fafb;
                padding: 15px 20px;
                border-top: 1px solid #e5e7eb;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .status-badge {
                padding: 6px 14px;
                border-radius: 20px;
                font-weight: 600;
                font-size: 0.85rem;
            }
            
            .priority-badge {
                padding: 4px 12px;
                border-radius: 15px;
                font-weight: 500;
                font-size: 0.8rem;
            }
            
            .filter-btn {
                border: 2px solid #e5e7eb;
                border-radius: 12px;
                padding: 8px 16px;
                margin: 0 5px 8px 0;
                background: white;
                color: #374151;
                font-weight: 500;
                transition: all 0.2s;
                text-decoration: none;
                display: inline-block;
            }
            
            .filter-btn:hover, .filter-btn.active {
                background: #8b5cf6;
                border-color: #8b5cf6;
                color: white;
                text-decoration: none;
            }
            
            .info-item {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
                font-size: 0.9rem;
            }
            
            .info-label {
                color: #6b7280;
                font-weight: 500;
                margin-right: 8px;
                min-width: 100px;
            }
            
            .info-value {
                color: #111827;
                font-weight: 600;
            }
        </style>
        
        <!-- Hero Section -->
        <div class="services-hero">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="display-6 fw-bold mb-2">
                            <i class="bi bi-tools me-3"></i>
                            Historial de Servicios T√©cnicos
                        </h1>
                        <p class="lead mb-0 opacity-90">
                            <span t-field="equipment.name.name"/> - Serie: <span t-field="equipment.serie_id"/>
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="status-badge bg-light text-dark">
                            <i class="bi bi-tools me-2"></i>
                            <span t-esc="len(services)"/> Servicios
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <!-- Filtros -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-funnel me-2"></i>Filtrar por estado:
                            </h6>
                            <div class="d-flex flex-wrap">
                                <t t-foreach="filters.items()" t-as="filter_item">
                                    <a t-att-href="'/my/copier/equipment/%s/services?filterby=%s' % (equipment.id, filter_item[0])"
                                       t-attf-class="filter-btn {{ filterby == filter_item[0] and 'active' or '' }}">
                                        <span t-esc="filter_item[1]['label']"/>
                                        <span class="badge bg-secondary ms-2" t-esc="filter_item[1]['count']"/>
                                    </a>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sin servicios -->
            <t t-if="not services">
                <div class="text-center py-5">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body p-5">
                            <i class="bi bi-inbox" style="font-size: 4rem; color: #9ca3af; margin-bottom: 20px;"></i>
                            <h3 class="fw-bold text-muted mb-3">No hay servicios registrados</h3>
                            <p class="text-muted mb-4">
                                <t t-if="filterby != 'all'">
                                    No se encontraron servicios con el filtro seleccionado.
                                </t>
                                <t t-else="">
                                    Este equipo a√∫n no tiene servicios t√©cnicos registrados.
                                </t>
                            </p>
                            <a t-attf-href="/public/service_request?copier_company_id=#{equipment.id}" 
                               class="btn btn-primary btn-lg">
                                <i class="bi bi-plus-circle me-2"></i>
                                Reportar Problema
                            </a>
                        </div>
                    </div>
                </div>
            </t>
            
            <!-- Lista de servicios -->
            <t t-if="services">
                <div class="row">
                    <t t-foreach="services" t-as="service">
                        <div class="col-12">
                            <div class="service-card" t-attf-onclick="window.location.href='/my/copier/service/#{service.id}'">
                                <!-- Header -->
                                <div class="service-header">
                                    <div class="row align-items-center">
                                        <div class="col-md-8">
                                            <h5 class="fw-bold mb-1 text-dark">
                                                <i class="bi bi-wrench me-2 text-primary"></i>
                                                <span t-field="service.name"/>
                                            </h5>
                                            <p class="text-muted mb-0">
                                                <span t-field="service.tipo_problema_id.name"/>
                                            </p>
                                        </div>
                                        <div class="col-md-4 text-end">
                                            <!-- Estado -->
                                            <span t-if="service.estado == 'nuevo'" class="status-badge bg-info text-white">
                                                <i class="bi bi-circle-fill me-1"></i>Nuevo
                                            </span>
                                            <span t-elif="service.estado == 'asignado'" class="status-badge bg-primary text-white">
                                                <i class="bi bi-person-check me-1"></i>Asignado
                                            </span>
                                            <span t-elif="service.estado == 'confirmado'" class="status-badge bg-warning text-dark">
                                                <i class="bi bi-calendar-check me-1"></i>Confirmado
                                            </span>
                                            <span t-elif="service.estado == 'en_ruta'" class="status-badge bg-purple text-white" style="background: #8b5cf6 !important;">
                                                <i class="bi bi-truck me-1"></i>En Ruta
                                            </span>
                                            <span t-elif="service.estado == 'en_sitio'" class="status-badge bg-warning text-dark">
                                                <i class="bi bi-tools me-1"></i>En Sitio
                                            </span>
                                            <span t-elif="service.estado == 'pausado'" class="status-badge bg-secondary text-white">
                                                <i class="bi bi-pause-circle me-1"></i>Pausado
                                            </span>
                                            <span t-elif="service.estado == 'completado'" class="status-badge bg-success text-white">
                                                <i class="bi bi-check-circle me-1"></i>Completado
                                            </span>
                                            <span t-elif="service.estado == 'cancelado'" class="status-badge bg-danger text-white">
                                                <i class="bi bi-x-circle me-1"></i>Cancelado
                                            </span>
                                            
                                            <br/>
                                            
                                            <!-- Prioridad -->
                                            <span t-if="service.prioridad == '3'" class="priority-badge bg-danger text-white mt-2">
                                                üî¥ Cr√≠tica
                                            </span>
                                            <span t-elif="service.prioridad == '2'" class="priority-badge bg-warning text-dark mt-2">
                                                üü† Alta
                                            </span>
                                            <span t-elif="service.prioridad == '1'" class="priority-badge bg-info text-white mt-2">
                                                üîµ Normal
                                            </span>
                                            <span t-else="" class="priority-badge bg-secondary text-white mt-2">
                                                ‚ö™ Baja
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Body -->
                                <div class="service-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="info-item">
                                                <span class="info-label">
                                                    <i class="bi bi-calendar me-1"></i>Fecha:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.create_date" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                                </span>
                                            </div>
                                            
                                            <div class="info-item" t-if="service.tecnico_id">
                                                <span class="info-label">
                                                    <i class="bi bi-person me-1"></i>T√©cnico:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.tecnico_id.name"/>
                                                </span>
                                            </div>
                                            
                                            <div class="info-item" t-if="service.contacto">
                                                <span class="info-label">
                                                    <i class="bi bi-person-badge me-1"></i>Report√≥:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.contacto"/>
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="info-item" t-if="service.fecha_programada">
                                                <span class="info-label">
                                                    <i class="bi bi-clock me-1"></i>Programado:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.fecha_programada" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                                </span>
                                            </div>
                                            
                                            <div class="info-item" t-if="service.duracion_real">
                                                <span class="info-label">
                                                    <i class="bi bi-hourglass me-1"></i>Duraci√≥n:
                                                </span>
                                                <span class="info-value">
                                                    <span t-esc="'%.1f' % service.duracion_real"/> hrs
                                                </span>
                                            </div>
                                            
                                            <div class="info-item" t-if="service.sla_cumplido and service.estado == 'completado'">
                                                <span class="info-label">
                                                    <i class="bi bi-speedometer me-1"></i>SLA:
                                                </span>
                                                <span class="info-value text-success">
                                                    ‚úì Cumplido
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Problema reportado -->
                                    <div class="mt-3 p-3 bg-light rounded">
                                        <small class="text-muted fw-semibold d-block mb-2">
                                            <i class="bi bi-chat-left-text me-1"></i>Problema:
                                        </small>
                                        <p class="mb-0 text-dark" t-field="service.problema_reportado"/>
                                    </div>
                                </div>
                                
                                <!-- Footer -->
                                <div class="service-footer" onclick="event.stopPropagation();">
                                    <small class="text-muted">
                                        <i class="bi bi-hash"></i>
                                        <span t-field="service.name"/>
                                    </small>
                                    <a t-attf-href="/my/copier/service/#{service.id}" 
                                       class="btn btn-sm btn-primary">
                                        <i class="bi bi-eye me-1"></i>Ver Detalle
                                    </a>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </t>
            
            <!-- Bot√≥n volver -->
            <div class="text-center mt-4 mb-4">
                <a t-att-href="'/my/copier/equipment/%s' % equipment.id" 
                   class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-arrow-left me-2"></i>
                    Volver al Equipo
                </a>
            </div>
        </div>
    </t>
</template>
<!-- ============================================================
     NUEVO TEMPLATE: DETALLE DE UN SERVICIO T√âCNICO
     ============================================================ -->
<template id="portal_my_copier_service_detail" name="Service Detail">
    <t t-call="portal.portal_layout">
        <t t-set="breadcrumbs_searchbar" t-value="True"/>
        
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap');
            @import url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css');
            
            .service-detail-hero {
                background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
                color: white;
                border-radius: 0 0 30px 30px;
                margin: -20px -15px 30px;
                padding: 40px 15px;
            }
            
            .detail-card {
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                border: 1px solid #e5e7eb;
                margin-bottom: 20px;
            }
            
            .detail-card-header {
                background: linear-gradient(135deg, #f8fafc, #e2e8f0);
                padding: 20px;
                border-bottom: 2px solid #e5e7eb;
                border-radius: 16px 16px 0 0;
            }
            
            .detail-card-body {
                padding: 20px;
            }
            
            .info-row {
                display: flex;
                justify-content: space-between;
                padding: 12px 0;
                border-bottom: 1px solid #f3f4f6;
            }
            
            .info-row:last-child {
                border-bottom: none;
            }
            
            .info-label {
                color: #6b7280;
                font-weight: 500;
            }
            
            .info-value {
                color: #111827;
                font-weight: 600;
                text-align: right;
            }
            
            .timeline {
                position: relative;
                padding-left: 30px;
            }
            
            .timeline-item {
                position: relative;
                padding-bottom: 20px;
            }
            
            .timeline-item::before {
                content: '';
                position: absolute;
                left: -22px;
                top: 0;
                width: 12px;
                height: 12px;
                border-radius: 50%;
                background: #8b5cf6;
                border: 3px solid white;
                box-shadow: 0 0 0 2px #8b5cf6;
            }
            
            .timeline-item::after {
                content: '';
                position: absolute;
                left: -17px;
                top: 12px;
                width: 2px;
                height: 100%;
                background: #e5e7eb;
            }
            
            .timeline-item:last-child::after {
                display: none;
            }
        </style>
        
        <!-- Hero -->
        <div class="service-detail-hero">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="display-6 fw-bold mb-2">
                            <i class="bi bi-tools me-3"></i>
                            <span t-field="service.name"/>
                        </h1>
                        <p class="lead mb-0 opacity-90">
                            <span t-field="service.tipo_problema_id.name"/>
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <!-- Estado -->
                        <span t-if="service.estado == 'nuevo'" class="badge bg-info text-white fs-6 px-3 py-2">
                            <i class="bi bi-circle-fill me-1"></i>Nuevo
                        </span>
                        <span t-elif="service.estado == 'asignado'" class="badge bg-primary text-white fs-6 px-3 py-2">
                            <i class="bi bi-person-check me-1"></i>Asignado
                        </span>
                        <span t-elif="service.estado == 'confirmado'" class="badge bg-warning text-dark fs-6 px-3 py-2">
                            <i class="bi bi-calendar-check me-1"></i>Confirmado
                        </span>
                        <span t-elif="service.estado == 'en_ruta'" class="badge text-white fs-6 px-3 py-2" style="background: #8b5cf6;">
                            <i class="bi bi-truck me-1"></i>En Ruta
                        </span>
                        <span t-elif="service.estado == 'en_sitio'" class="badge bg-warning text-dark fs-6 px-3 py-2">
                            <i class="bi bi-tools me-1"></i>En Sitio
                        </span>
                        <span t-elif="service.estado == 'pausado'" class="badge bg-secondary text-white fs-6 px-3 py-2">
                            <i class="bi bi-pause-circle me-1"></i>Pausado
                        </span>
                        <span t-elif="service.estado == 'completado'" class="badge bg-success text-white fs-6 px-3 py-2">
                            <i class="bi bi-check-circle me-1"></i>Completado
                        </span>
                        <span t-elif="service.estado == 'cancelado'" class="badge bg-danger text-white fs-6 px-3 py-2">
                            <i class="bi bi-x-circle me-1"></i>Cancelado
                        </span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <div class="row">
                <!-- Informaci√≥n del Servicio -->
                <div class="col-lg-8 mb-4">
                    <!-- Detalles del Problema -->
                    <div class="detail-card">
                        <div class="detail-card-header">
                            <h5 class="fw-bold mb-0 text-primary">
                                <i class="bi bi-info-circle me-2"></i>
                                Detalles del Problema
                            </h5>
                        </div>
                        <div class="detail-card-body">
                            <div class="info-row">
                                <span class="info-label">Tipo de Problema:</span>
                                <span class="info-value" t-field="service.tipo_problema_id.name"/>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Prioridad:</span>
                                <span class="info-value">
                                    <span t-if="service.prioridad == '3'" class="badge bg-danger">üî¥ Cr√≠tica</span>
                                    <span t-elif="service.prioridad == '2'" class="badge bg-warning text-dark">üü† Alta</span>
                                    <span t-elif="service.prioridad == '1'" class="badge bg-info">üîµ Normal</span>
                                    <span t-else="" class="badge bg-secondary">‚ö™ Baja</span>
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Origen:</span>
                                <span class="info-value">
                                    <span t-if="service.origen_solicitud == 'whatsapp'">üì± WhatsApp/QR</span>
                                    <span t-elif="service.origen_solicitud == 'portal'">üåê Portal Web</span>
                                    <span t-elif="service.origen_solicitud == 'telefono'">üìû Tel√©fono</span>
                                    <span t-elif="service.origen_solicitud == 'email'">üìß Email</span>
                                    <span t-else="">üè¢ Interno</span>
                                </span>
                            </div>
                            
                            <div class="mt-4 p-4 bg-light rounded">
                                <h6 class="fw-semibold mb-3 text-dark">
                                    <i class="bi bi-chat-left-text me-2"></i>Descripci√≥n del Problema:
                                </h6>
                                <p class="mb-0 text-dark" style="white-space: pre-wrap;" t-field="service.problema_reportado"/>
                            </div>
                            
                            <!-- Foto antes (si existe) -->
                            <div class="mt-4" t-if="service.foto_antes">
                                <h6 class="fw-semibold mb-3 text-dark">
                                    <i class="bi bi-camera me-2"></i>Fotograf√≠a del Problema:
                                </h6>
                                <img class="img-fluid rounded shadow-sm" 
                                     t-att-src="image_data_uri(service.foto_antes)" 
                                     alt="Foto del problema"
                                     style="max-height: 400px;"/>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trabajo Realizado (si est√° completado) -->
                    <div class="detail-card" t-if="service.estado == 'completado' and service.trabajo_realizado">
                        <div class="detail-card-header">
                            <h5 class="fw-bold mb-0 text-success">
                                <i class="bi bi-check2-square me-2"></i>
                                Trabajo Realizado
                            </h5>
                        </div>
                        <div class="detail-card-body">
                            <div class="p-4 bg-light rounded">
                                <p class="mb-0 text-dark" style="white-space: pre-wrap;" t-field="service.trabajo_realizado"/>
                            </div>
                            
                            <!-- Foto despu√©s (si existe) -->
                            <div class="mt-4" t-if="service.foto_despues">
                                <h6 class="fw-semibold mb-3 text-dark">
                                    <i class="bi bi-camera me-2"></i>Fotograf√≠a Post-Servicio:
                                </h6>
                                <img class="img-fluid rounded shadow-sm" 
                                     t-att-src="image_data_uri(service.foto_despues)" 
                                     alt="Foto despu√©s del servicio"
                                     style="max-height: 400px;"/>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar con informaci√≥n adicional -->
                <div class="col-lg-4">
                    <!-- Informaci√≥n del Equipo -->
                    <div class="detail-card">
                        <div class="detail-card-header">
                            <h6 class="fw-bold mb-0 text-dark">
                                <i class="bi bi-printer me-2"></i>
                                Equipo
                            </h6>
                        </div>
                        <div class="detail-card-body">
                            <div class="info-row">
                                <span class="info-label">Modelo:</span>
                                <span class="info-value" t-field="service.modelo_maquina.name"/>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Serie:</span>
                                <span class="info-value" t-field="service.serie_maquina"/>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Ubicaci√≥n:</span>
                                <span class="info-value" t-field="service.ubicacion"/>
                            </div>
                            <div class="info-row" t-if="service.sede">
                                <span class="info-label">Sede:</span>
                                <span class="info-value" t-field="service.sede"/>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Informaci√≥n del Contacto -->
                    <div class="detail-card">
                        <div class="detail-card-header">
                            <h6 class="fw-bold mb-0 text-dark">
                                <i class="bi bi-person me-2"></i>
                                Contacto
                            </h6>
                        </div>
                        <div class="detail-card-body">
                            <div class="info-row" t-if="service.contacto">
                                <span class="info-label">Nombre:</span>
                                <span class="info-value" t-field="service.contacto"/>
                            </div>
                            <div class="info-row" t-if="service.correo">
                                <span class="info-label">Email:</span>
                                <span class="info-value">
                                    <a t-att-href="'mailto:%s' % service.correo" t-field="service.correo"/>
                                </span>
                            </div>
                            <div class="info-row" t-if="service.telefono_contacto">
                                <span class="info-label">Tel√©fono:</span>
                                <span class="info-value" t-field="service.telefono_contacto"/>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Informaci√≥n del T√©cnico -->
                    <div class="detail-card" t-if="service.tecnico_id">
                        <div class="detail-card-header">
                            <h6 class="fw-bold mb-0 text-dark">
                                <i class="bi bi-person-badge me-2"></i>
                                T√©cnico Asignado
                            </h6>
                        </div>
                        <div class="detail-card-body">
                            <div class="text-center mb-3">
                                <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" 
                                     style="width: 60px; height: 60px;">
                                    <i class="bi bi-person-fill fs-3"></i>
                                </div>
                            </div>
                            <h6 class="text-center fw-bold text-dark mb-3" t-field="service.tecnico_id.name"/>
                            <div class="info-row" t-if="service.fecha_programada">
                                <span class="info-label">Fecha programada:</span>
                                <span class="info-value">
                                    <span t-field="service.fecha_programada" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Timeline del Servicio -->
                    <div class="detail-card">
                        <div class="detail-card-header">
                            <h6 class="fw-bold mb-0 text-dark">
                                <i class="bi bi-clock-history me-2"></i>
                                Historial
                            </h6>
                        </div>
                        <div class="detail-card-body">
                            <div class="timeline">
                                <div class="timeline-item">
                                    <small class="text-muted">Creado</small>
                                    <div class="fw-semibold">
                                        <span t-field="service.create_date" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                    </div>
                                </div>
                                
                                <div class="timeline-item" t-if="service.fecha_inicio">
                                    <small class="text-muted">Iniciado</small>
                                    <div class="fw-semibold">
                                        <span t-field="service.fecha_inicio" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                    </div>
                                </div>
                                
                                <div class="timeline-item" t-if="service.fecha_fin">
                                    <small class="text-muted">Completado</small>
                                    <div class="fw-semibold">
                                        <span t-field="service.fecha_fin" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                    </div>
                                </div>
                                
                                <div class="timeline-item" t-if="service.duracion_real">
                                    <small class="text-muted">Duraci√≥n total</small>
                                    <div class="fw-semibold">
                                        <span t-esc="'%.1f' % service.duracion_real"/> horas
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bot√≥n volver -->
            <div class="text-center mt-4 mb-4">
                <a t-att-href="'/my/copier/equipment/%s/services' % service.maquina_id.id" 
                   class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-arrow-left me-2"></i>
                    Volver a Servicios
                </a>
            </div>
        </div>
    </t>
</template>
<!-- ============================================================
     TODOS LOS SERVICIOS DEL CLIENTE (DE TODOS SUS EQUIPOS)
     ============================================================ -->
<template id="portal_my_services_all" name="All My Services">
    <t t-call="portal.portal_layout">
        <t t-set="breadcrumbs_searchbar" t-value="True"/>
        
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap');
            @import url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css');
            
            .services-hero {
                background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
                color: white;
                border-radius: 0 0 30px 30px;
                margin: -20px -15px 30px;
                padding: 40px 15px;
            }
            
            .service-card {
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                border: 2px solid #f1f5f9;
                margin-bottom: 20px;
                transition: all 0.3s ease;
                cursor: pointer;
            }
            
            .service-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 40px rgba(0,0,0,0.12);
                border-color: #8b5cf6;
            }
            
            .service-header {
                background: linear-gradient(135deg, #fafafa, #f3f4f6);
                padding: 20px;
                border-bottom: 2px solid #e5e7eb;
            }
            
            .service-body { padding: 20px; }
            
            .service-footer {
                background: #f9fafb;
                padding: 15px 20px;
                border-top: 1px solid #e5e7eb;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .status-badge {
                padding: 6px 14px;
                border-radius: 20px;
                font-weight: 600;
                font-size: 0.85rem;
            }
            
            .filter-btn {
                border: 2px solid #e5e7eb;
                border-radius: 12px;
                padding: 8px 16px;
                margin: 0 5px 8px 0;
                background: white;
                color: #374151;
                font-weight: 500;
                transition: all 0.2s;
                text-decoration: none;
                display: inline-block;
            }
            
            .filter-btn:hover, .filter-btn.active {
                background: #8b5cf6;
                border-color: #8b5cf6;
                color: white;
                text-decoration: none;
            }
            
            .info-item {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
                font-size: 0.9rem;
            }
            
            .info-label {
                color: #6b7280;
                font-weight: 500;
                margin-right: 8px;
            }
            
            .info-value {
                color: #111827;
                font-weight: 600;
            }
            
            .equipment-badge {
                background: #f3f4f6;
                padding: 4px 12px;
                border-radius: 12px;
                font-size: 0.85rem;
                color: #374151;
                font-weight: 500;
            }
        </style>
        
        <!-- Hero -->
        <div class="services-hero">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="display-6 fw-bold mb-2">
                            <i class="bi bi-tools me-3"></i>
                            Mis Servicios T√©cnicos
                        </h1>
                        <p class="lead mb-0 opacity-90">
                            Historial completo de servicios de todos tus equipos
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="status-badge bg-light text-dark">
                            <i class="bi bi-tools me-2"></i>
                            <span t-esc="len(services)"/> Servicios
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <!-- Filtros -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-funnel me-2"></i>Filtrar por estado:
                            </h6>
                            <div class="d-flex flex-wrap">
                                <t t-foreach="filters.items()" t-as="filter_item">
                                    <a t-att-href="'/my/copier/services?filterby=%s' % filter_item[0]"
                                       t-attf-class="filter-btn {{ filterby == filter_item[0] and 'active' or '' }}">
                                        <span t-esc="filter_item[1]['label']"/>
                                        <span class="badge bg-secondary ms-2" t-esc="filter_item[1]['count']"/>
                                    </a>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sin servicios -->
            <t t-if="not services">
                <div class="text-center py-5">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body p-5">
                            <i class="bi bi-inbox" style="font-size: 4rem; color: #9ca3af; margin-bottom: 20px;"></i>
                            <h3 class="fw-bold text-muted mb-3">No hay servicios registrados</h3>
                            <p class="text-muted mb-4">
                                <t t-if="filterby != 'all'">
                                    No se encontraron servicios con el filtro seleccionado.
                                </t>
                                <t t-else="">
                                    A√∫n no tienes servicios t√©cnicos registrados.
                                </t>
                            </p>
                            <a href="/my/copier/equipments" class="btn btn-primary btn-lg">
                                <i class="bi bi-printer me-2"></i>
                                Ver Mis Equipos
                            </a>
                        </div>
                    </div>
                </div>
            </t>
            
            <!-- Lista de servicios -->
            <t t-if="services">
                <div class="row">
                    <t t-foreach="services" t-as="service">
                        <div class="col-12">
                            <div class="service-card" t-attf-onclick="window.location.href='/my/copier/service/#{service.id}'">
                                <!-- Header -->
                                <div class="service-header">
                                    <div class="row align-items-center">
                                        <div class="col-md-8">
                                            <h5 class="fw-bold mb-1 text-dark">
                                                <i class="bi bi-wrench me-2 text-primary"></i>
                                                <span t-field="service.name"/>
                                            </h5>
                                            <p class="text-muted mb-2">
                                                <span t-field="service.tipo_problema_id.name"/>
                                            </p>
                                            <!-- Mostrar equipo -->
                                            <div class="equipment-badge">
                                                <i class="bi bi-printer me-1"></i>
                                                <span t-field="service.modelo_maquina.name"/> - 
                                                Serie: <span t-field="service.serie_maquina"/>
                                            </div>
                                        </div>
                                        <div class="col-md-4 text-end">
                                            <!-- Estado -->
                                            <span t-if="service.estado == 'nuevo'" class="status-badge bg-info text-white">
                                                <i class="bi bi-circle-fill me-1"></i>Nuevo
                                            </span>
                                            <span t-elif="service.estado == 'asignado'" class="status-badge bg-primary text-white">
                                                <i class="bi bi-person-check me-1"></i>Asignado
                                            </span>
                                            <span t-elif="service.estado == 'confirmado'" class="status-badge bg-warning text-dark">
                                                <i class="bi bi-calendar-check me-1"></i>Confirmado
                                            </span>
                                            <span t-elif="service.estado == 'en_ruta'" class="status-badge text-white" style="background: #8b5cf6;">
                                                <i class="bi bi-truck me-1"></i>En Ruta
                                            </span>
                                            <span t-elif="service.estado == 'en_sitio'" class="status-badge bg-warning text-dark">
                                                <i class="bi bi-tools me-1"></i>En Sitio
                                            </span>
                                            <span t-elif="service.estado == 'pausado'" class="status-badge bg-secondary text-white">
                                                <i class="bi bi-pause-circle me-1"></i>Pausado
                                            </span>
                                            <span t-elif="service.estado == 'completado'" class="status-badge bg-success text-white">
                                                <i class="bi bi-check-circle me-1"></i>Completado
                                            </span>
                                            <span t-elif="service.estado == 'cancelado'" class="status-badge bg-danger text-white">
                                                <i class="bi bi-x-circle me-1"></i>Cancelado
                                            </span>
                                            
                                            <br/>
                                            
                                            <!-- Prioridad -->
                                            <span t-if="service.prioridad == '3'" class="status-badge bg-danger text-white mt-2">
                                                üî¥ Cr√≠tica
                                            </span>
                                            <span t-elif="service.prioridad == '2'" class="status-badge bg-warning text-dark mt-2">
                                                üü† Alta
                                            </span>
                                            <span t-elif="service.prioridad == '1'" class="status-badge bg-info text-white mt-2">
                                                üîµ Normal
                                            </span>
                                            <span t-else="" class="status-badge bg-secondary text-white mt-2">
                                                ‚ö™ Baja
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Body -->
                                <div class="service-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="info-item">
                                                <span class="info-label">
                                                    <i class="bi bi-calendar me-1"></i>Fecha:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.create_date" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                                </span>
                                            </div>
                                            
                                            <div class="info-item" t-if="service.tecnico_id">
                                                <span class="info-label">
                                                    <i class="bi bi-person me-1"></i>T√©cnico:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.tecnico_id.name"/>
                                                </span>
                                            </div>
                                            
                                            <div class="info-item" t-if="service.ubicacion">
                                                <span class="info-label">
                                                    <i class="bi bi-geo-alt me-1"></i>Ubicaci√≥n:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.ubicacion"/>
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="info-item" t-if="service.fecha_programada">
                                                <span class="info-label">
                                                    <i class="bi bi-clock me-1"></i>Programado:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.fecha_programada" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                                </span>
                                            </div>
                                            
                                            <div class="info-item" t-if="service.duracion_real">
                                                <span class="info-label">
                                                    <i class="bi bi-hourglass me-1"></i>Duraci√≥n:
                                                </span>
                                                <span class="info-value">
                                                    <span t-esc="'%.1f' % service.duracion_real"/> hrs
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Problema reportado -->
                                    <div class="mt-3 p-3 bg-light rounded">
                                        <small class="text-muted fw-semibold d-block mb-2">
                                            <i class="bi bi-chat-left-text me-1"></i>Problema:
                                        </small>
                                        <p class="mb-0 text-dark" t-field="service.problema_reportado"/>
                                    </div>
                                </div>
                                
                                <!-- Footer -->
                                <div class="service-footer" onclick="event.stopPropagation();">
                                    <small class="text-muted">
                                        <i class="bi bi-hash"></i>
                                        <span t-field="service.name"/>
                                    </small>
                                    <a t-attf-href="/my/copier/service/#{service.id}" 
                                       class="btn btn-sm btn-primary">
                                        <i class="bi bi-eye me-1"></i>Ver Detalle
                                    </a>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </t>
            
            <!-- Bot√≥n volver -->
            <div class="text-center mt-4 mb-4">
                <a href="/my" class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-arrow-left me-2"></i>
                    Volver al Portal
                </a>
            </div>
        </div>
    </t>
</template>
</odoo>