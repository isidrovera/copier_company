<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Integración con menú de navegación del portal - Breadcrumbs -->
    <template id="portal_breadcrumbs_copier" name="Portal layout : copier equipment breadcrumbs" inherit_id="portal.portal_breadcrumbs" priority="50">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'equipment' or page_name == 'equipment_detail' or page_name == 'equipment_counters'" t-attf-class="breadcrumb-item #{'active ' if page_name == 'equipment' else ''}">
                <a t-if="page_name in ['equipment_detail', 'equipment_counters']" t-attf-href="/my/copier/equipments?{{ keep_query() }}">Mis Equipos</a>
                <t t-else="">Mis Equipos</t>
            </li>
            <li t-if="page_name == 'equipment_detail' and equipment" class="breadcrumb-item active text-truncate">
                <span t-field="equipment.name.name"/> (<span t-field="equipment.serie_id"/>)
            </li>
            <li t-if="page_name == 'equipment_counters' and equipment" class="breadcrumb-item">
                <a t-attf-href="/my/copier/equipment/{{equipment.id}}"><span t-field="equipment.name.name"/></a>
            </li>
            <li t-if="page_name == 'equipment_counters'" class="breadcrumb-item active">
                Lecturas
            </li>
            <li t-if="page_name == 'equipment_services' or page_name == 'service_detail'" 
                t-attf-class="breadcrumb-item #{'active ' if page_name == 'equipment_services' else ''}">
                <a t-if="page_name == 'service_detail'" 
                t-attf-href="/my/copier/equipment/{{equipment.id}}/services">
                    Servicios
                </a>
                <t t-else="">Servicios</t>
            </li>

            <!-- Breadcrumb para detalle de servicio -->
            <li t-if="page_name == 'service_detail' and service" class="breadcrumb-item active">
                <span t-field="service.name"/>
            </li>
        </xpath>
    </template>

    <!-- Integración con el home del portal -->
        <!-- Integración con el home del portal -->
    <template id="portal_my_home_copier_equipment"
              inherit_id="portal.portal_my_home"
              name="Mis Equipos en el Portal"
              priority="50">

        <xpath expr="//div[@id='oe_structure_portal_my_home_2']" position="before">
            <div class="o_portal_category row g-2 mt-3">
                <t t-call="portal.portal_docs_entry">
                    <t t-set="icon" t-value="'/copier_company/static/src/img/printer.svg'"/>
                    <t t-set="title">Mis Equipos</t>
                    <t t-set="text">Consulta los equipos que tienes en alquiler</t>
                    <t t-set="url" t-value="'/my/copier/equipments'"/>
                    <t t-set="config_card" t-value="True"/>
                    <t t-set="placeholder_count" t-value="'equipment_count'"/>
                </t>
            </div>
        </xpath>

    </template>



    

    <!-- Template para la página de listado de equipos en formato LISTA -->
<template id="portal_my_copier_equipments" name="My Rental Equipments">
    <t t-call="portal.portal_layout">
        <t t-set="breadcrumbs_searchbar" t-value="True"/>
        <t t-call="portal.portal_searchbar">
            <t t-set="title">Mis Equipos en Alquiler</t>
        </t>
        
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap');
            @import url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css');
            @import url('https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css');
            
            * { font-family: 'Inter', sans-serif; }
            
            .equipments-hero {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 0 0 30px 30px;
                margin: -20px -15px 30px;
                padding: 40px 15px;
                position: relative;
                overflow: hidden;
            }
            
            .equipments-hero::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="white" opacity="0.1"><polygon points="1000,100 1000,0 0,100"/></svg>');
                background-size: cover;
            }
            
            .equipment-card {
                background: white;
                border-radius: 20px;
                box-shadow: 0 8px 30px rgba(0,0,0,0.08);
                border: 2px solid #f1f5f9;
                margin-bottom: 20px;
                transition: all 0.3s ease;
                cursor: pointer;
                overflow: hidden;
            }
            
            .equipment-card:hover {
                transform: translateY(-8px);
                box-shadow: 0 20px 60px rgba(0,0,0,0.15);
                border-color: #3b82f6;
            }
            
            .equipment-header {
                background: linear-gradient(135deg, #f8fafc, #e2e8f0);
                padding: 20px 25px;
                border-bottom: 1px solid #e5e7eb;
            }
            
            .equipment-body {
                padding: 25px;
            }
            
            .equipment-actions {
                background: #f8fafc;
                padding: 15px 25px;
                border-top: 1px solid #e5e7eb;
            }
            
            .action-btn {
                background: white;
                border: 2px solid #e5e7eb;
                border-radius: 12px;
                padding: 8px 16px;
                margin: 0 5px 8px 0;
                font-size: 0.875rem;
                font-weight: 500;
                transition: all 0.2s ease;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                color: #374151;
            }
            
            .action-btn:hover {
                transform: translateY(-2px);
                text-decoration: none;
                color: white;
            }
            
            .action-btn.btn-primary:hover { background: #3b82f6; border-color: #3b82f6; }
            .action-btn.btn-success:hover { background: #10b981; border-color: #10b981; }
            .action-btn.btn-info:hover { background: #06b6d4; border-color: #06b6d4; }
            .action-btn.btn-warning:hover { background: #f59e0b; border-color: #f59e0b; }
            .action-btn.btn-danger:hover { background: #ef4444; border-color: #ef4444; }
            .action-btn.btn-purple:hover { background: #8b5cf6; border-color: #8b5cf6; }
            
            .equipment-info {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                margin-bottom: 15px;
            }
            
            .info-item {
                display: flex;
                align-items: center;
                font-size: 0.9rem;
            }
            
            .info-label {
                color: #6b7280;
                font-weight: 500;
                margin-right: 8px;
            }
            
            .info-value {
                color: #111827;
                font-weight: 600;
            }
            
            .status-badge {
                padding: 6px 14px;
                border-radius: 20px;
                font-weight: 600;
                font-size: 0.8rem;
                display: inline-flex;
                align-items: center;
            }
            
            .type-badge {
                padding: 4px 12px;
                border-radius: 15px;
                font-weight: 500;
                font-size: 0.8rem;
            }
            
            .equipment-title {
                font-size: 1.25rem;
                font-weight: 700;
                color: #111827;
                margin-bottom: 8px;
                display: flex;
                align-items: center;
            }
            
            .equipment-subtitle {
                color: #6b7280;
                font-size: 0.9rem;
                margin-bottom: 0;
            }
            
            .no-equipment-state {
                text-align: center;
                padding: 60px 20px;
                background: white;
                border-radius: 20px;
                box-shadow: 0 8px 30px rgba(0,0,0,0.08);
                margin-top: 40px;
            }
            
            .stats-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid #f3f4f6;
            }
            
            .contract-dates {
                font-size: 0.85rem;
                color: #6b7280;
            }
            
            @media (max-width: 768px) {
                .equipments-hero {
                    margin: -20px -15px 20px;
                    padding: 30px 15px;
                    border-radius: 0 0 20px 20px;
                }
                
                .equipment-card {
                    margin-bottom: 15px;
                }
                
                .equipment-header, .equipment-body, .equipment-actions {
                    padding: 15px 20px;
                }
                
                .equipment-info {
                    flex-direction: column;
                    gap: 10px;
                }
                
                .action-btn {
                    margin: 0 3px 6px 0;
                    padding: 6px 12px;
                    font-size: 0.8rem;
                }
            }
        </style>
        
        <!-- Hero Section -->
        <div class="equipments-hero animate__animated animate__fadeInDown">
            <div class="container position-relative">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="display-6 fw-bold mb-2">
                            <i class="bi bi-collection me-3"></i>
                            Mis Equipos en Alquiler
                        </h1>
                        <p class="lead mb-0 opacity-90">
                            Gestiona todos tus equipos desde un solo lugar
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="status-badge bg-light text-dark">
                            <i class="bi bi-collection me-2"></i>
                            <span t-esc="len(equipments)"/> Equipos
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <!-- Sin equipos -->
            <t t-if="not equipments">
                <div class="no-equipment-state animate__animated animate__fadeInUp">
                    <i class="bi bi-inbox" style="font-size: 4rem; color: #9ca3af; margin-bottom: 20px;"></i>
                    <h3 class="fw-bold text-muted mb-3">No tienes equipos en alquiler</h3>
                    <p class="text-muted mb-4">Cuando tengas equipos asignados, aparecerán aquí para que puedas gestionarlos.</p>
                    <a href="/contacto" class="btn btn-primary btn-lg">
                        <i class="bi bi-telephone me-2"></i>
                        Contactar Ventas
                    </a>
                </div>
            </t>
            
            <!-- Lista de equipos -->
            <t t-if="equipments">
                <div class="row">
                    <div t-foreach="equipments" t-as="equipment" class="col-12 animate__animated animate__fadeInUp" t-attf-style="animation-delay: #{equipment_index * 0.1}s">
                        <div class="equipment-card" t-attf-onclick="window.location.href='/my/copier/equipment/#{equipment.id}'">
                            <!-- Header con título y estado -->
                            <div class="equipment-header">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <div class="equipment-title">
                                            <i class="bi bi-printer me-2 text-primary"></i>
                                            <span t-field="equipment.name.name"/>
                                        </div>
                                        <div class="equipment-subtitle">
                                            Serie: <span t-field="equipment.serie_id"/> | 
                                            <span t-field="equipment.marca_id.name"/>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <div t-if="equipment.tipo == 'monocroma'" class="type-badge bg-secondary text-white mb-2">
                                            <i class="bi bi-circle-fill me-1"></i>
                                            Blanco y Negro
                                        </div>
                                        <div t-else="" class="type-badge bg-primary text-white mb-2">
                                            <i class="bi bi-palette me-1"></i>
                                            Color
                                        </div>
                                        <br/>
                                        <span t-field="equipment.estado_maquina_id.name" 
                                              t-attf-class="status-badge {{ equipment.estado_maquina_id.name == 'Disponible' and 'bg-success text-white' or 'bg-info text-white' }}">
                                            <i class="bi bi-check-circle me-1"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Body con información del equipo -->
                            <div class="equipment-body">
                                <div class="equipment-info">
                                    <div class="info-item">
                                        <span class="info-label">
                                            <i class="bi bi-geo-alt text-warning me-1"></i>
                                            Ubicación:
                                        </span>
                                        <span class="info-value" t-field="equipment.ubicacion"/>
                                    </div>
                                    
                                    <div class="info-item">
                                        <span class="info-label">
                                            <i class="bi bi-clock text-info me-1"></i>
                                            Duración:
                                        </span>
                                        <span class="info-value" t-field="equipment.duracion_alquiler_id.name"/>
                                    </div>
                                    
                                    <div class="info-item" t-if="equipment.sede">
                                        <span class="info-label">
                                            <i class="bi bi-building text-secondary me-1"></i>
                                            Sede:
                                        </span>
                                        <span class="info-value" t-field="equipment.sede"/>
                                    </div>
                                </div>
                                
                                <div class="stats-row">
                                    <div class="contract-dates">
                                        <i class="bi bi-calendar-range me-1"></i>
                                        <strong>Desde:</strong> <span t-field="equipment.fecha_inicio_alquiler"/> | 
                                        <strong>Hasta:</strong> <span t-field="equipment.fecha_fin_alquiler"/>
                                    </div>
                                    <div class="text-end">
                                        <small class="text-muted">
                                            <i class="bi bi-info-circle me-1"></i>
                                            Clic para ver detalles
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="equipment-actions" onclick="event.stopPropagation();">
                                <div class="d-flex flex-wrap align-items-center justify-content-between">
                                    <div class="actions-group">
                                        <a t-attf-href="/my/copier/equipment/#{equipment.id}" class="action-btn btn-primary">
                                            <i class="bi bi-eye me-1"></i>Ver Detalles
                                        </a>
                                        <a t-attf-href="/public/upload_counters?copier_company_id=#{equipment.id}" class="action-btn btn-success">
                                            <i class="bi bi-bar-chart me-1"></i>Contadores
                                        </a>
                                        <a t-attf-href="/public/request_toner?copier_company_id=#{equipment.id}" class="action-btn btn-info">
                                            <i class="bi bi-droplet me-1"></i>Toner
                                        </a>
                                        <a t-attf-href="/public/remote_assistance?copier_company_id=#{equipment.id}" class="action-btn btn-warning">
                                            <i class="bi bi-display me-1"></i>Asistencia
                                        </a>
                                        <a t-attf-href="/public/service_request?copier_company_id=#{equipment.id}" class="action-btn btn-danger">
                                            <i class="bi bi-exclamation-triangle me-1"></i>Problema
                                        </a>
                                        <a t-attf-href="/my/copier/equipment/#{equipment.id}/counters" class="action-btn btn-purple">
                                            <i class="bi bi-speedometer2 me-1"></i>Historial
                                        </a>
                                    </div>
                                    <div class="equipment-id text-muted">
                                        <small>
                                            <i class="bi bi-hash"></i>
                                            <span t-field="equipment.secuencia"/>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </div>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Añadir efecto hover mejorado a las tarjetas
                const equipmentCards = document.querySelectorAll('.equipment-card');
                
                equipmentCards.forEach(card =&gt; {
                    card.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-8px) scale(1.02)';
                    });
                    
                    card.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0) scale(1)';
                    });
                });
                
                // Prevenir propagación del click en los botones de acción
                const actionButtons = document.querySelectorAll('.action-btn');
                actionButtons.forEach(btn =&gt; {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                    });
                });
                
                // Animación escalonada para las tarjetas
                const cards = document.querySelectorAll('.equipment-card');
                cards.forEach((card, index) =&gt; {
                    setTimeout(() =&gt; {
                        card.style.opacity = '0';
                        card.style.transform = 'translateY(30px)';
                        card.style.transition = 'all 0.6s ease';
                        
                        setTimeout(() =&gt; {
                            card.style.opacity = '1';
                            card.style.transform = 'translateY(0)';
                        }, 50);
                    }, index * 150);
                });
            });
        </script>
    </t>
</template>
    <!--Vista que muestra detalle de equipo se puede crear ticket, toner, asistemcia remota-->
 <template id="portal_my_copier_equipment" name="My Rental Equipment Details">
    <t t-call="portal.portal_layout">
        <t t-set="wrapwrap_classes" t-value="'o_portal_bg_dark'"/>
        
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap');
            @import url('https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css');
            @import url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css');
            
            * { font-family: 'Inter', sans-serif; }
            
            .hero-equipment {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 0 0 30px 30px;
                margin: -20px -15px 0;
                padding: 40px 15px;
                position: relative;
                overflow: hidden;
            }
            
            .hero-equipment::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="white" opacity="0.1"><polygon points="1000,100 1000,0 0,100"/></svg>');
                background-size: cover;
            }
            
            .equipment-card {
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.1);
                border: none;
                transition: all 0.3s ease;
                margin-top: -40px;
                position: relative;
                z-index: 10;
            }
            
            .equipment-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 25px 80px rgba(0,0,0,0.15);
            }
            
            .action-card {
                background: linear-gradient(135deg, #fff, #f8fafc);
                border: 2px solid #e2e8f0;
                border-radius: 16px;
                padding: 20px;
                text-align: center;
                transition: all 0.3s ease;
                text-decoration: none;
                color: inherit;
                display: block;
                height: 100%;
            }
            
            .action-card:hover {
                transform: translateY(-8px);
                box-shadow: 0 15px 40px rgba(0,0,0,0.1);
                border-color: #3b82f6;
                text-decoration: none;
                color: #1f2937;
            }
            
            .action-icon {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 15px;
                font-size: 24px;
                color: white;
                transition: all 0.3s ease;
            }
            
            .action-card:hover .action-icon {
                transform: scale(1.1);
            }
            
            .bg-gradient-primary { background: linear-gradient(135deg, #3b82f6, #1e40af) !important; }
            .bg-gradient-success { background: linear-gradient(135deg, #10b981, #047857) !important; }
            .bg-gradient-warning { background: linear-gradient(135deg, #f59e0b, #d97706) !important; }
            .bg-gradient-danger { background: linear-gradient(135deg, #ef4444, #dc2626) !important; }
            .bg-gradient-info { background: linear-gradient(135deg, #06b6d4, #0891b2) !important; }
            .bg-gradient-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important; }
            
            .info-card {
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                border: 1px solid #e5e7eb;
                margin-bottom: 20px;
                overflow: hidden;
            }
            
            .info-card-header {
                background: linear-gradient(135deg, #f8fafc, #e2e8f0);
                padding: 20px;
                border-bottom: 1px solid #e5e7eb;
            }
            
            .info-row {
                padding: 12px 20px;
                border-bottom: 1px solid #f3f4f6;
                transition: background 0.2s ease;
            }
            
            .info-row:last-child {
                border-bottom: none;
            }
            
            .info-row:hover {
                background: #f9fafb;
            }
            
            .qr-card {
                background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
                border: 2px solid #0ea5e9;
                border-radius: 16px;
                text-align: center;
                padding: 20px;
            }
            
            .status-badge {
                padding: 8px 16px;
                border-radius: 20px;
                font-weight: 600;
                font-size: 0.875rem;
            }
            
            .equipment-image {
                max-width: 100%;
                height: auto;
                border-radius: 16px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            }
            
            @media (max-width: 768px) {
                .hero-equipment {
                    margin: -20px -15px 0;
                    border-radius: 0 0 20px 20px;
                    padding: 30px 15px;
                }
                
                .equipment-card {
                    margin-top: -20px;
                }
            }
            
        </style>
        
        <!-- Hero Section -->
        <div class="hero-equipment animate__animated animate__fadeInDown">
            <div class="container position-relative">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="display-6 fw-bold mb-2">
                            <i class="bi bi-printer me-3"></i>
                            <span t-field="equipment.name.name"/>
                        </h1>
                        <p class="lead mb-0 opacity-90">
                            Serie: <span t-field="equipment.serie_id"/> | 
                            <span t-if="equipment.tipo == 'monocroma'">Blanco y Negro</span>
                            <span t-else="">Color</span>
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="status-badge bg-success text-white">
                            <i class="bi bi-check-circle me-2"></i>
                            Equipo Activo
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container mt-4">
            <div class="row">
                <!-- Panel de Acciones -->
                <div class="col-lg-4 mb-4">
                    <div class="equipment-card animate__animated animate__fadeInLeft">
                        <div class="card-body p-4">
                            <h5 class="fw-bold mb-4 text-center">
                                <i class="bi bi-lightning me-2 text-primary"></i>
                                Acciones Rápidas
                            </h5>
                            
                            <div class="row g-3">
                                <!-- Reportar Contadores -->
                                <div class="col-12">
                                    <a t-attf-href="/public/upload_counters?copier_company_id=#{equipment.id}" class="action-card">
                                        <div class="action-icon bg-gradient-primary">
                                            <i class="bi bi-bar-chart"></i>
                                        </div>
                                        <h6 class="fw-semibold mb-2">Reportar Contadores</h6>
                                        <p class="text-muted small mb-0">Envía las lecturas mensuales</p>
                                    </a>
                                </div>
                                
                                <!-- Solicitar Toner -->
                                <div class="col-12">
                                    <a t-attf-href="/public/request_toner?copier_company_id=#{equipment.id}" class="action-card">
                                        <div class="action-icon bg-gradient-success">
                                            <i class="bi bi-droplet"></i>
                                        </div>
                                        <h6 class="fw-semibold mb-2">Solicitar Toner</h6>
                                        <p class="text-muted small mb-0">Pide reposición de consumibles</p>
                                    </a>
                                </div>
                                
                                <!-- Asistencia Remota -->
                                <div class="col-12">
                                    <a t-attf-href="/public/remote_assistance?copier_company_id=#{equipment.id}" class="action-card">
                                        <div class="action-icon bg-gradient-info">
                                            <i class="bi bi-display"></i>
                                        </div>
                                        <h6 class="fw-semibold mb-2">Asistencia Remota</h6>
                                        <p class="text-muted small mb-0">Solicita ayuda técnica</p>
                                    </a>
                                </div>
                                
                                <!-- Reportar Problema -->
                                <div class="col-12">
                                    <a t-attf-href="/public/service_request?copier_company_id=#{equipment.id}" class="action-card">
                                        <div class="action-icon bg-gradient-danger">
                                            <i class="bi bi-exclamation-triangle"></i>
                                        </div>
                                        <h6 class="fw-semibold mb-2">Reportar Problema</h6>
                                        <p class="text-muted small mb-0">Reporta fallas o incidencias</p>
                                    </a>
                                </div>
                                
                                <!-- Ver Lecturas -->
                                <div class="col-12">
                                    <a t-att-href="'/my/copier/equipment/%s/counters' % equipment.id" class="action-card">
                                        <div class="action-icon bg-gradient-purple">
                                            <i class="bi bi-speedometer2"></i>
                                        </div>
                                        <h6 class="fw-semibold mb-2">Ver Lecturas</h6>
                                        <p class="text-muted small mb-0">Historial de contadores</p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Código QR -->
                    <div class="qr-card animate__animated animate__fadeInLeft animate__delay-1s" t-if="equipment.qr_code">
                        <h5 class="fw-bold mb-3 text-primary">
                            <i class="bi bi-qr-code me-2"></i>
                            Código QR
                        </h5>
                        <img class="img-fluid mb-3" t-att-src="image_data_uri(equipment.qr_code)" alt="Código QR" style="max-width: 200px;"/>
                        <p class="text-muted mb-0">Escanea para acceso rápido</p>
                    </div>
                </div>
                
                <!-- Información Principal -->
                <div class="col-lg-8">
                    <div class="row">
                        <!-- Detalles del Equipo -->
                        <div class="col-12 mb-4">
                            <div class="info-card animate__animated animate__fadeInRight">
                                <div class="info-card-header">
                                    <h5 class="fw-bold mb-0 text-primary">
                                        <i class="bi bi-info-circle me-2"></i>
                                        Detalles del Equipo
                                    </h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="row">
                                        <!-- Imagen del equipo -->
                                        <div class="col-md-4 p-4 text-center" t-if="equipment.imagen_id">
                                            <img class="equipment-image" t-att-src="image_data_uri(equipment.imagen_id)" alt="Imagen de la Máquina"/>
                                        </div>
                                        
                                        <!-- Datos básicos -->
                                        <div t-att-class="equipment.imagen_id and 'col-md-8 p-0' or 'col-md-12 p-0'">
                                            <div class="info-row">
                                                <div class="row">
                                                    <div class="col-sm-4 fw-semibold text-muted">Marca:</div>
                                                    <div class="col-sm-8" t-field="equipment.marca_id.name"/>
                                                </div>
                                            </div>
                                            <div class="info-row">
                                                <div class="row">
                                                    <div class="col-sm-4 fw-semibold text-muted">Serie:</div>
                                                    <div class="col-sm-8 fw-mono" t-field="equipment.serie_id"/>
                                                </div>
                                            </div>
                                            <div class="info-row">
                                                <div class="row">
                                                    <div class="col-sm-4 fw-semibold text-muted">Tipo:</div>
                                                    <div class="col-sm-8">
                                                        <span t-if="equipment.tipo == 'monocroma'" class="badge bg-secondary">Blanco y Negro</span>
                                                        <span t-else="" class="badge bg-primary">Color</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="info-row">
                                                <div class="row">
                                                    <div class="col-sm-4 fw-semibold text-muted">Formato:</div>
                                                    <div class="col-sm-8" t-field="equipment.formato"/>
                                                </div>
                                            </div>
                                            <div class="info-row">
                                                <div class="row">
                                                    <div class="col-sm-4 fw-semibold text-muted">Ubicación:</div>
                                                    <div class="col-sm-8">
                                                        <i class="bi bi-geo-alt text-warning me-2"></i>
                                                        <span t-field="equipment.ubicacion"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="info-row" t-if="equipment.sede">
                                                <div class="row">
                                                    <div class="col-sm-4 fw-semibold text-muted">Sede:</div>
                                                    <div class="col-sm-8" t-field="equipment.sede"/>
                                                </div>
                                            </div>
                                            <div class="info-row" t-if="equipment.ip_id">
                                                <div class="row">
                                                    <div class="col-sm-4 fw-semibold text-muted">IP:</div>
                                                    <div class="col-sm-8 fw-mono text-info" t-field="equipment.ip_id"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Información del Contrato -->
                        <div class="col-md-6 mb-4">
                            <div class="info-card animate__animated animate__fadeInRight animate__delay-1s">
                                <div class="info-card-header">
                                    <h5 class="fw-bold mb-0 text-success">
                                        <i class="bi bi-file-earmark-text me-2"></i>
                                        Contrato
                                    </h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="info-row">
                                        <div class="row">
                                            <div class="col-6 fw-semibold text-muted">Cotización:</div>
                                            <div class="col-6 fw-mono" t-field="equipment.secuencia"/>
                                        </div>
                                    </div>
                                    <div class="info-row">
                                        <div class="row">
                                            <div class="col-6 fw-semibold text-muted">Inicio:</div>
                                            <div class="col-6" t-field="equipment.fecha_inicio_alquiler"/>
                                        </div>
                                    </div>
                                    <div class="info-row">
                                        <div class="row">
                                            <div class="col-6 fw-semibold text-muted">Fin:</div>
                                            <div class="col-6" t-field="equipment.fecha_fin_alquiler"/>
                                        </div>
                                    </div>
                                    <div class="info-row">
                                        <div class="row">
                                            <div class="col-6 fw-semibold text-muted">Duración:</div>
                                            <div class="col-6" t-field="equipment.duracion_alquiler_id.name"/>
                                        </div>
                                    </div>
                                    <div class="info-row">
                                        <div class="row">
                                            <div class="col-6 fw-semibold text-muted">Estado:</div>
                                            <div class="col-6">
                                                <span t-field="equipment.estado_renovacion" 
                                                      t-attf-class="badge {{ equipment.estado_renovacion == 'vigente' and 'bg-success' or (equipment.estado_renovacion == 'por_vencer' and 'bg-warning' or 'bg-danger') }}"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Información de Costos -->
                        <div class="col-md-6 mb-4">
                            <div class="info-card animate__animated animate__fadeInRight animate__delay-2s">
                                <div class="info-card-header">
                                    <h5 class="fw-bold mb-0 text-info">
                                        <i class="bi bi-cash-coin me-2"></i>
                                        Costos
                                    </h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="info-row">
                                        <div class="row">
                                            <div class="col-7 fw-semibold text-muted">Copia B/N:</div>
                                            <div class="col-5 text-end">
                                                <span class="fw-bold text-primary">S/ <span t-field="equipment.costo_copia_bn"/></span>
                                                <t t-if="equipment.precio_bn_incluye_igv">
                                                    <br/><small class="text-muted">(inc. IGV)</small>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="info-row" t-if="equipment.tipo == 'color'">
                                        <div class="row">
                                            <div class="col-7 fw-semibold text-muted">Copia Color:</div>
                                            <div class="col-5 text-end">
                                                <span class="fw-bold text-danger">S/ <span t-field="equipment.costo_copia_color"/></span>
                                                <t t-if="equipment.precio_color_incluye_igv">
                                                    <br/><small class="text-muted">(inc. IGV)</small>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="info-row">
                                        <div class="row">
                                            <div class="col-7 fw-semibold text-muted">Vol. mensual B/N:</div>
                                            <div class="col-5 text-end fw-bold" t-field="equipment.volumen_mensual_bn"/>
                                        </div>
                                    </div>
                                    <div class="info-row" t-if="equipment.tipo == 'color'">
                                        <div class="row">
                                            <div class="col-7 fw-semibold text-muted">Vol. mensual Color:</div>
                                            <div class="col-5 text-end fw-bold" t-field="equipment.volumen_mensual_color"/>
                                        </div>
                                    </div>
                                    <div class="info-row">
                                        <div class="row">
                                            <div class="col-7 fw-semibold text-muted">Facturación día:</div>
                                            <div class="col-5 text-end fw-bold" t-field="equipment.dia_facturacion"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Especificaciones Técnicas -->
                        <div class="col-12 mb-4" t-if="equipment.especificaciones_id">
                            <div class="info-card animate__animated animate__fadeInUp">
                                <div class="info-card-header">
                                    <h5 class="fw-bold mb-0 text-secondary">
                                        <i class="fa fa-cogs me-2"></i>
                                        Especificaciones Técnicas
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div t-field="equipment.especificaciones_id" class="specifications-content"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            // Efectos adicionales
            document.addEventListener('DOMContentLoaded', function() {
                // Efecto hover en las tarjetas de información
                const infoRows = document.querySelectorAll('.info-row');
                infoRows.forEach(row =&gt; {
                    row.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateX(5px)';
                        this.style.transition = 'transform 0.2s ease';
                    });
                    
                    row.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateX(0)';
                    });
                });
                
                // Animación secuencial de las tarjetas de acción
                const actionCards = document.querySelectorAll('.action-card');
                actionCards.forEach((card, index) =&gt; {
                    setTimeout(() =&gt; {
                        card.style.opacity = '0';
                        card.style.transform = 'translateY(20px)';
                        card.style.transition = 'all 0.5s ease';
                        
                        setTimeout(() =&gt; {
                            card.style.opacity = '1';
                            card.style.transform = 'translateY(0)';
                        }, 100);
                    }, index * 100);
                });
            });
        </script>
    </t>
</template>
    
   
    
    <!-- Template para la página de contadores -->
    <template id="portal_my_copier_counters" name="My Equipment Counters">
    <t t-call="portal.portal_layout">
        <t t-set="breadcrumbs_searchbar" t-value="True"/>
        
        <!-- Incluir Bootstrap Icons, Chart.js y archivos CSS/JS -->
        <t t-set="head">
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"/>
            <link rel="stylesheet" type="text/css" href="/copier_company/static/src/css/counter_charts.css"/>
            <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
            <script type="text/javascript" src="/copier_company/static/src/js/counter_charts.js"></script>
        </t>
        
        <t t-call="portal.portal_searchbar">
            <t t-set="title">Historial de Lecturas</t>
        </t>
                <style>
            /* ================================
               FIX NAV PILLS GRÁFICOS (graphTabs)
               ================================ */

            /* Pestaña activa: fondo claro + texto azul */
            #graphTabs .nav-link.active {
                background-color: #e9f1ff !important;   /* azul clarito */
                color: #1e40af !important;              /* azul oscuro */
                font-weight: 600;
                border-radius: 0;
                border-bottom: 3px solid #1e40af;       /* subrayado inferior */
            }

            /* Pestañas inactivas */
            #graphTabs .nav-link {
                background-color: #ffffff !important;
                color: #374151 !important;
                border-radius: 0;
                border-bottom: 3px solid transparent;
            }

            /* Hover */
            #graphTabs .nav-link:hover {
                background-color: #f1f5f9 !important;
                color: #1e40af !important;
            }
        </style>

        
        <!-- Header del equipo con diseño mejorado -->
        <div class="container-fluid px-0">
            <div class="row g-4">
                <div class="col-12">
                    <!-- Card principal con mejor diseño -->
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-dark text-white py-3">
                            <div class="d-flex align-items-center justify-content-between">
                                <div>
                                    <h3 class="mb-1 fw-bold text-white">
                                        <i class="bi bi-speedometer2 me-2"></i>
                                        <span t-field="equipment.name.name"/>
                                    </h3>
                                    <p class="mb-0 text-white-50">
                                        <i class="bi bi-upc-scan me-1"></i>
                                        Serie: <span t-field="equipment.serie_id" class="fw-semibold text-white"/>
                                    </p>
                                </div>
                                <div class="text-end">
                                    <span t-field="equipment.tipo" 
                                          t-attf-class="badge fs-6 px-3 py-2 text-dark bg-{{ equipment.tipo == 'color' and 'warning' or 'light' }}">
                                        <i t-attf-class="bi bi-{{ equipment.tipo == 'color' and 'palette' or 'circle-fill' }} me-1"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-body p-4">
                            <!-- Estado sin datos -->
                            <t t-if="not counters">
                                <div class="text-center py-5">
                                    <div class="mb-4">
                                        <i class="bi bi-graph-up text-muted" style="font-size: 4rem; opacity: 0.5;"></i>
                                    </div>
                                    <h5 class="text-muted">No hay registros de lecturas</h5>
                                    <p class="text-muted">Aún no se han registrado lecturas para este equipo</p>
                                </div>
                            </t>
                            
                            <!-- Contenido principal cuando hay datos -->
                            <t t-if="counters">
                                <!-- Tarjetas de resumen mejoradas -->
                                <div class="row g-3 mb-4">
                                    <div class="col-md-6">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-shrink-0">
                                                        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                                                            <i class="bi bi-file-earmark-text fs-5"></i>
                                                        </div>
                                                    </div>
                                                    <div class="flex-grow-1 ms-3">
                                                        <h6 class="mb-1 text-dark fw-semibold">Volumen Contratado</h6>
                                                        <div class="row g-2 small">
                                                            <div class="col-6">
                                                                <strong class="text-dark">B/N:</strong> 
                                                                <span t-field="equipment.volumen_mensual_bn" class="text-primary fw-bold"/>
                                                            </div>
                                                            <div class="col-6" t-if="equipment.tipo == 'color'">
                                                                <strong class="text-dark">Color:</strong> 
                                                                <span t-field="equipment.volumen_mensual_color" class="text-success fw-bold"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-shrink-0">
                                                        <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                                                            <i class="bi bi-bar-chart fs-5"></i>
                                                        </div>
                                                    </div>
                                                    <div class="flex-grow-1 ms-3">
                                                        <h6 class="mb-1 text-dark fw-semibold">Consumo Actual</h6>
                                                        <t t-if="counters and counters[0].state != 'draft'">
                                                            <div class="row g-2 small">
                                                                <div class="col-6">
                                                                    <strong class="text-dark">B/N:</strong> 
                                                                    <span t-field="counters[0].total_copias_bn" class="text-primary fw-bold"/>
                                                                </div>
                                                                <div class="col-6" t-if="equipment.tipo == 'color'">
                                                                    <strong class="text-dark">Color:</strong> 
                                                                    <span t-field="counters[0].total_copias_color" class="text-success fw-bold"/>
                                                                </div>
                                                            </div>
                                                        </t>
                                                        <small t-else="" class="text-muted">
                                                            <i class="bi bi-clock me-1"></i>Sin datos confirmados
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Gráficos con diseño mejorado -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-white border-bottom">
                                        <h5 class="mb-0 fw-bold text-dark">
                                            <i class="bi bi-graph-up me-2 text-primary"></i>
                                            Análisis de Consumo
                                        </h5>
                                    </div>
                                    <div class="card-body p-0">
                                        <!-- Navegación de pestañas mejorada -->
                                        <ul class="nav nav-pills nav-fill border-bottom mb-0" id="graphTabs" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link active rounded-0 py-3 text-dark" 
                                                        id="monthly-tab" 
                                                        data-bs-toggle="tab" 
                                                        data-bs-target="#monthly" 
                                                        type="button" 
                                                        role="tab">
                                                    <i class="bi bi-calendar3 me-2"></i>
                                                    Consumo Mensual
                                                </button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link rounded-0 py-3 text-dark" 
                                                        id="yearly-tab" 
                                                        data-bs-toggle="tab" 
                                                        data-bs-target="#yearly" 
                                                        type="button" 
                                                        role="tab">
                                                    <i class="bi bi-bar-chart-line me-2"></i>
                                                    Consumo Anual
                                                </button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link rounded-0 py-3 text-dark" 
                                                        id="user-monthly-tab" 
                                                        data-bs-toggle="tab" 
                                                        data-bs-target="#user-monthly" 
                                                        type="button" 
                                                        role="tab">
                                                    <i class="bi bi-people me-2"></i>
                                                    Por Usuario
                                                </button>
                                            </li>
                                        </ul>
                                        
                                        <div class="tab-content" id="graphTabsContent">
                                            <div class="tab-pane fade show active p-4" id="monthly" role="tabpanel">
                                                <div class="chart-container" style="height: 400px;">
                                                    <canvas id="monthlyChart"></canvas>
                                                </div>
                                            </div>
                                            <div class="tab-pane fade p-4" id="yearly" role="tabpanel">
                                                <div class="chart-container" style="height: 400px;">
                                                    <canvas id="yearlyChart"></canvas>
                                                </div>
                                            </div>
                                            <div class="tab-pane fade p-4" id="user-monthly" role="tabpanel">
                                                <div class="chart-container" style="height: 400px;">
                                                    <canvas id="userMonthlyChart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Tabla de datos mejorada -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0 fw-bold text-dark">
                                            <i class="bi bi-table me-2 text-primary"></i>
                                            Historial de Lecturas
                                        </h5>
                                        <div class="btn-group">
                                            <!-- PDF con todas las lecturas del equipo -->
                                            <a t-att-href="'/my/copier/equipment/%s/counters/pdf' % equipment.id"
                                            class="btn btn-sm btn-outline-primary">
                                                <i class="bi bi-file-earmark-pdf me-1"></i>
                                                PDF
                                            </a>
                                            <!-- Excel con todas las lecturas del equipo -->
                                            <a t-att-href="'/my/copier/equipment/%s/counters/xlsx' % equipment.id"
                                            class="btn btn-sm btn-outline-success">
                                                <i class="bi bi-file-earmark-excel me-1"></i>
                                                Excel
                                            </a>
                                        </div>
                                    </div>

                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0 align-middle">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th class="fw-bold">Referencia</th>
                                                        <th class="fw-bold">Fecha</th>
                                                        <th class="fw-bold">Mes Facturación</th>
                                                        <th class="fw-bold text-center">Anterior B/N</th>
                                                        <th class="fw-bold text-center">Actual B/N</th>
                                                        <th class="fw-bold text-center">Total B/N</th>
                                                        <th t-if="equipment.tipo == 'color'" class="fw-bold text-center">Anterior Color</th>
                                                        <th t-if="equipment.tipo == 'color'" class="fw-bold text-center">Actual Color</th>
                                                        <th t-if="equipment.tipo == 'color'" class="fw-bold text-center">Total Color</th>
                                                        <th class="fw-bold text-center">Estado</th>
                                                        <!-- NUEVA COLUMNA ACCIONES -->
                                                        <th class="fw-bold text-center">Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr t-foreach="counters" t-as="counter" class="border-bottom">
                                                        <td class="fw-semibold">
                                                            <span t-field="counter.name"/>
                                                        </td>
                                                        <td>
                                                            <span t-field="counter.fecha" t-options="{'widget': 'date'}"/>
                                                        </td>
                                                        <td>
                                                            <span t-field="counter.mes_facturacion"/>
                                                        </td>
                                                        <td class="text-center font-monospace">
                                                            <span t-field="counter.contador_anterior_bn" t-options="{'widget': 'integer'}"/>
                                                        </td>
                                                        <td class="text-center font-monospace">
                                                            <span t-field="counter.contador_actual_bn" t-options="{'widget': 'integer'}"/>
                                                        </td>
                                                        <td class="text-center font-monospace fw-bold text-primary">
                                                            <span t-field="counter.total_copias_bn" t-options="{'widget': 'integer'}"/>
                                                        </td>
                                                        <td t-if="equipment.tipo == 'color'" class="text-center font-monospace">
                                                            <span t-field="counter.contador_anterior_color" t-options="{'widget': 'integer'}"/>
                                                        </td>
                                                        <td t-if="equipment.tipo == 'color'" class="text-center font-monospace">
                                                            <span t-field="counter.contador_actual_color" t-options="{'widget': 'integer'}"/>
                                                        </td>
                                                        <td t-if="equipment.tipo == 'color'" class="text-center font-monospace fw-bold text-success">
                                                            <span t-field="counter.total_copias_color" t-options="{'widget': 'integer'}"/>
                                                        </td>
                                                        <td class="text-center">
                                                            <span t-field="counter.state"
                                                                t-attf-class="badge rounded-pill px-3 py-2 bg-{{ counter.state == 'draft' and 'warning' or (counter.state == 'confirmed' and 'success' or (counter.state == 'invoiced' and 'info' or 'danger')) }}"/>
                                                        </td>
                                                        <!-- ACCIÓN PDF POR FILA -->
                                                        <td class="text-center">
                                                            <a t-att-href="'/my/copier/counter/%s/pdf' % counter.id"
                                                            class="btn btn-sm btn-outline-primary">
                                                                <i class="bi bi-file-earmark-pdf"></i>
                                                            </a>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                
                                <!-- Detalle de facturación mejorado -->
                                <div class="row g-4 mb-4">
                                    <div class="col-lg-6">
                                        <div class="card border-0 bg-primary bg-opacity-10 border-start border-primary border-4">
                                            <div class="card-body">
                                                <h6 class="card-title text-primary fw-bold mb-3">
                                                    <i class="bi bi-calculator me-2"></i>
                                                    Tarifas Contratadas
                                                </h6>
                                                <div class="row g-3">
                                                    <div class="col-sm-6">
                                                        <div class="d-flex justify-content-between">
                                                            <span class="text-dark">Precio B/N:</span>
                                                            <span t-field="equipment.costo_copia_bn" 
                                                                  t-options="{'widget': 'monetary', 'display_currency': equipment.currency_id}" 
                                                                  class="fw-bold text-dark"/>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6" t-if="equipment.tipo == 'color'">
                                                        <div class="d-flex justify-content-between">
                                                            <span class="text-dark">Precio Color:</span>
                                                            <span t-field="equipment.costo_copia_color" 
                                                                  t-options="{'widget': 'monetary', 'display_currency': equipment.currency_id}" 
                                                                  class="fw-bold text-dark"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-6">
                                        <div class="card border-0 bg-success bg-opacity-10 border-start border-success border-4">
                                            <div class="card-body">
                                                <h6 class="card-title text-success fw-bold mb-3">
                                                    <i class="bi bi-pie-chart me-2"></i>
                                                    Excesos del Período
                                                </h6>
                                                <t t-if="counters and counters[0].state != 'draft'">
                                                    <div class="row g-3">
                                                        <div class="col-sm-6">
                                                            <div class="d-flex justify-content-between">
                                                                <span class="text-dark">Exceso B/N:</span>
                                                                <span t-field="counters[0].exceso_bn" 
                                                                      t-options="{'widget': 'integer'}" 
                                                                      class="fw-bold text-dark"/>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-6" t-if="equipment.tipo == 'color'">
                                                            <div class="d-flex justify-content-between">
                                                                <span class="text-dark">Exceso Color:</span>
                                                                <span t-field="counters[0].exceso_color" 
                                                                      t-options="{'widget': 'integer'}" 
                                                                      class="fw-bold text-dark"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                                <div t-else="" class="text-center text-muted">
                                                    <i class="bi bi-clock me-1"></i>
                                                    Esperando confirmación de datos
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </div>
                </div>
            </div>
            
           <!-- Detalle por usuario mejorado -->
<t t-if="counters and equipment and counters[0].informe_por_usuario">
    <div class="row g-4 mt-2">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0 fw-bold text-white">
                        <i class="bi bi-people me-2"></i>
                        Detalle de Copias por Usuario
                    </h5>
                </div>
                <div class="card-body">
                    <t t-if="counters[0].usuario_detalle_ids">
                        <div class="row g-4">
                            <div class="col-lg-6">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="fw-bold">Usuario / Empresa</th>
                                                <th class="fw-bold text-center">Copias</th>
                                                <th class="fw-bold text-center">Porcentaje</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr t-foreach="counters[0].usuario_detalle_ids" t-as="line">
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
                                                            <i class="bi bi-person-fill" style="font-size: 14px;"></i>
                                                        </div>
                                                        <span t-esc="line.usuario_id.name" class="fw-semibold text-dark"/>
                                                    </div>
                                                </td>
                                                <td class="text-center font-monospace fw-bold">
                                                    <span t-esc="line.cantidad_copias"/>
                                                </td>
                                                <td class="text-center">
                                                    <div class="progress" style="height: 8px;">
                                                        <div class="progress-bar bg-primary" 
                                                             role="progressbar" 
                                                             t-att-style="'width: {}%'.format(line.cantidad_copias / counters[0].total_copias_bn * 100 if counters[0].total_copias_bn > 0 else 0)">
                                                        </div>
                                                    </div>
                                                    <small class="text-muted">
                                                        <span t-esc="round(line.cantidad_copias / counters[0].total_copias_bn * 100, 1) if counters[0].total_copias_bn > 0 else 0"/>%
                                                    </small>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="chart-container" style="height: 300px;">
                                    <canvas id="userDetailChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </t>
                    <t t-else="">
                        <div class="text-center py-4">
                            <i class="bi bi-person-x text-muted mb-3" style="font-size: 3rem; opacity: 0.5;"></i>
                            <h6 class="text-muted">Sin datos de usuarios</h6>
                            <p class="text-muted mb-0">No hay registros de copias por usuario en este período</p>
                        </div>
                    </t>
                </div>
            </div>
        </div>
    </div>
</t>
<!-- Nueva pestaña -->
<li class="nav-item" role="presentation">
    <button class="nav-link active rounded-0 py-3 text-dark"
        id="user-tab"
        data-bs-toggle="tab"
        data-bs-target="#user"
        type="button"
        role="tab">
  <i class="bi bi-people me-2"></i>Por Usuario (Actual)
</button>
</li>
<div class="tab-pane fade show active p-4" id="user" role="tabpanel">
  <div class="chart-container" style="height: 400px;">
    <canvas id="userChart"></canvas>
  </div>
</div>


<!-- Gráfico por usuario adicional -->
<div class="row g-4 mt-2">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold text-dark">
                    <i class="bi bi-pie-chart me-2 text-primary"></i>
                    Análisis de Copias por Usuario por Mes
                </h5>
            </div>
            <div class="card-body">
                <t t-if="counters and len([c for c in counters if c.usuario_detalle_ids]) > 0">
                    <!-- Filtros por mes -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="monthFilter" class="form-label fw-semibold">Filtrar por mes:</label>
                            <select id="monthFilter" class="form-select">
                                <option value="">Todos los meses</option>
                                <!-- Se llenará dinámicamente -->
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="chartType" class="form-label fw-semibold">Tipo de gráfico:</label>
                            <select id="chartType" class="form-select">
                                <option value="doughnut">Doughnut Chart</option>
                                <option value="pie">Pie Chart</option>
                                <option value="bar">Bar Chart</option>
                                <option value="line">Line Chart</option>
                                <option value="polarArea">Polar Area Chart</option>
                                <option value="radar">Radar Chart</option>
                                <option value="scatter">Scatter Chart</option>
                                <option value="bubble">Bubble Chart</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="chart-container" style="height: 400px;">
                        <canvas id="userAnalysisChart"></canvas>
                    </div>
                </t>
                <t t-else="">
                    <div class="text-center py-4">
                        <i class="bi bi-pie-chart text-muted mb-3" style="font-size: 3rem; opacity: 0.5;"></i>
                        <h6 class="text-muted">Sin datos para mostrar</h6>
                        <p class="text-muted mb-0">No hay datos de usuarios para generar el gráfico</p>
                    </div>
                </t>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Inyectando datos de usuario desde template...');
        
        // Preparar datos de todos los meses con usuarios
        const userData = [];
        
        <t t-foreach="counters" t-as="counter">
            <t t-if="counter.usuario_detalle_ids">
                console.log('📅 Agregando datos del contador:', '<t t-esc="counter.mes_facturacion"/>');
                userData.push({
                    month: '<t t-esc="counter.mes_facturacion"/>',
                    date: '<t t-esc="counter.fecha"/>',
                    name: '<t t-esc="counter.name"/>',
                    users: [
                        <t t-foreach="counter.usuario_detalle_ids" t-as="line">
                            {
                                name: '<t t-esc="line.usuario_id.name"/>',
                                copies: <t t-esc="line.cantidad_copias"/>
                            }<t t-if="not line_last">,</t>
                        </t>
                    ]
                });
            </t>
        </t>
        
        console.log('✅ Datos preparados:', userData);
        
        // Actualizar datos en el archivo JavaScript externo
        if (typeof window.updateUserDataFromTemplate === 'function') {
            window.updateUserDataFromTemplate(userData);
        } else {
            console.log('⏳ Esperando que se cargue counter_charts.js...');
            setTimeout(function() {
                if (typeof window.updateUserDataFromTemplate === 'function') {
                    window.updateUserDataFromTemplate(userData);
                }
            }, 1000);
        }
    });
</script>
            <!-- Botones de acción mejorados -->
            <div class="text-center mt-4 mb-4">
                <div class="btn-group" role="group">
                    <a t-att-href="'/my/copier/equipment/%s' % equipment.id" 
                       class="btn btn-outline-primary btn-lg">
                        <i class="bi bi-arrow-left me-2"></i>
                        Volver al Equipo
                    </a>
                    
                </div>
            </div>
            
            <!-- Datos para gráficos (oculto) -->
            <div id="charts-data" 
                 t-att-data-chart-data="chart_data"
                 t-att-data-is-color="'true' if equipment.tipo == 'color' else 'false'"
                 class="d-none">
            </div>
        </div>
    </t>
</template>

<!-- ============================================================
     NUEVO TEMPLATE: LISTA DE SERVICIOS DEL EQUIPO
     ============================================================ -->
<template id="portal_my_copier_equipment_services" name="Equipment Services History">
    <t t-call="portal.portal_layout">
        <t t-set="breadcrumbs_searchbar" t-value="True"/>
        
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap');
            @import url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css');
            
            .services-hero {
                background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
                color: white;
                border-radius: 0 0 30px 30px;
                margin: -20px -15px 30px;
                padding: 40px 15px;
            }
            
            .service-card {
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                border: 2px solid #f1f5f9;
                margin-bottom: 20px;
                transition: all 0.3s ease;
                cursor: pointer;
            }
            
            .service-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 40px rgba(0,0,0,0.12);
                border-color: #8b5cf6;
            }
            
            .service-header {
                background: linear-gradient(135deg, #fafafa, #f3f4f6);
                padding: 20px;
                border-bottom: 2px solid #e5e7eb;
            }
            
            .service-body { padding: 20px; }
            
            .service-footer {
                background: #f9fafb;
                padding: 15px 20px;
                border-top: 1px solid #e5e7eb;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .status-badge {
                padding: 6px 14px;
                border-radius: 20px;
                font-weight: 600;
                font-size: 0.85rem;
            }
            
            .priority-badge {
                padding: 4px 12px;
                border-radius: 15px;
                font-weight: 500;
                font-size: 0.8rem;
            }
            
            .filter-btn {
                border: 2px solid #e5e7eb;
                border-radius: 12px;
                padding: 8px 16px;
                margin: 0 5px 8px 0;
                background: white;
                color: #374151;
                font-weight: 500;
                transition: all 0.2s;
                text-decoration: none;
                display: inline-block;
            }
            
            .filter-btn:hover, .filter-btn.active {
                background: #8b5cf6;
                border-color: #8b5cf6;
                color: white;
                text-decoration: none;
            }
            
            .info-item {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
                font-size: 0.9rem;
            }
            
            .info-label {
                color: #6b7280;
                font-weight: 500;
                margin-right: 8px;
                min-width: 100px;
            }
            
            .info-value {
                color: #111827;
                font-weight: 600;
            }
        </style>
        
        <!-- Hero Section -->
        <div class="services-hero">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="display-6 fw-bold mb-2">
                            <i class="bi bi-tools me-3"></i>
                            Historial de Servicios Técnicos
                        </h1>
                        <p class="lead mb-0 opacity-90">
                            <span t-field="equipment.name.name"/> - Serie: <span t-field="equipment.serie_id"/>
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="status-badge bg-light text-dark">
                            <i class="bi bi-tools me-2"></i>
                            <span t-esc="len(services)"/> Servicios
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <!-- Filtros -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-funnel me-2"></i>Filtrar por estado:
                            </h6>
                            <div class="d-flex flex-wrap">
                                <t t-foreach="filters.items()" t-as="filter_item">
                                    <a t-att-href="'/my/copier/equipment/%s/services?filterby=%s' % (equipment.id, filter_item[0])"
                                       t-attf-class="filter-btn {{ filterby == filter_item[0] and 'active' or '' }}">
                                        <span t-esc="filter_item[1]['label']"/>
                                        <span class="badge bg-secondary ms-2" t-esc="filter_item[1]['count']"/>
                                    </a>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sin servicios -->
            <t t-if="not services">
                <div class="text-center py-5">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body p-5">
                            <i class="bi bi-inbox" style="font-size: 4rem; color: #9ca3af; margin-bottom: 20px;"></i>
                            <h3 class="fw-bold text-muted mb-3">No hay servicios registrados</h3>
                            <p class="text-muted mb-4">
                                <t t-if="filterby != 'all'">
                                    No se encontraron servicios con el filtro seleccionado.
                                </t>
                                <t t-else="">
                                    Este equipo aún no tiene servicios técnicos registrados.
                                </t>
                            </p>
                            <a t-attf-href="/public/service_request?copier_company_id=#{equipment.id}" 
                               class="btn btn-primary btn-lg">
                                <i class="bi bi-plus-circle me-2"></i>
                                Reportar Problema
                            </a>
                        </div>
                    </div>
                </div>
            </t>
            
            <!-- Lista de servicios -->
            <t t-if="services">
                <div class="row">
                    <t t-foreach="services" t-as="service">
                        <div class="col-12">
                            <div class="service-card" t-attf-onclick="window.location.href='/my/copier/service/#{service.id}'">
                                <!-- Header -->
                                <div class="service-header">
                                    <div class="row align-items-center">
                                        <div class="col-md-8">
                                            <h5 class="fw-bold mb-1 text-dark">
                                                <i class="bi bi-wrench me-2 text-primary"></i>
                                                <span t-field="service.name"/>
                                            </h5>
                                            <p class="text-muted mb-0">
                                                <span t-field="service.tipo_problema_id.name"/>
                                            </p>
                                        </div>
                                        <div class="col-md-4 text-end">
                                            <!-- Estado -->
                                            <span t-if="service.estado == 'nuevo'" class="status-badge bg-info text-white">
                                                <i class="bi bi-circle-fill me-1"></i>Nuevo
                                            </span>
                                            <span t-elif="service.estado == 'asignado'" class="status-badge bg-primary text-white">
                                                <i class="bi bi-person-check me-1"></i>Asignado
                                            </span>
                                            <span t-elif="service.estado == 'confirmado'" class="status-badge bg-warning text-dark">
                                                <i class="bi bi-calendar-check me-1"></i>Confirmado
                                            </span>
                                            <span t-elif="service.estado == 'en_ruta'" class="status-badge bg-purple text-white" style="background: #8b5cf6 !important;">
                                                <i class="bi bi-truck me-1"></i>En Ruta
                                            </span>
                                            <span t-elif="service.estado == 'en_sitio'" class="status-badge bg-warning text-dark">
                                                <i class="bi bi-tools me-1"></i>En Sitio
                                            </span>
                                            <span t-elif="service.estado == 'pausado'" class="status-badge bg-secondary text-white">
                                                <i class="bi bi-pause-circle me-1"></i>Pausado
                                            </span>
                                            <span t-elif="service.estado == 'completado'" class="status-badge bg-success text-white">
                                                <i class="bi bi-check-circle me-1"></i>Completado
                                            </span>
                                            <span t-elif="service.estado == 'cancelado'" class="status-badge bg-danger text-white">
                                                <i class="bi bi-x-circle me-1"></i>Cancelado
                                            </span>
                                            
                                            <br/>
                                            
                                            <!-- Prioridad -->
                                            <span t-if="service.prioridad == '3'" class="priority-badge bg-danger text-white mt-2">
                                                🔴 Crítica
                                            </span>
                                            <span t-elif="service.prioridad == '2'" class="priority-badge bg-warning text-dark mt-2">
                                                🟠 Alta
                                            </span>
                                            <span t-elif="service.prioridad == '1'" class="priority-badge bg-info text-white mt-2">
                                                🔵 Normal
                                            </span>
                                            <span t-else="" class="priority-badge bg-secondary text-white mt-2">
                                                ⚪ Baja
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Body -->
                                <div class="service-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="info-item">
                                                <span class="info-label">
                                                    <i class="bi bi-calendar me-1"></i>Fecha:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.create_date" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                                </span>
                                            </div>
                                            
                                            <div class="info-item" t-if="service.tecnico_id">
                                                <span class="info-label">
                                                    <i class="bi bi-person me-1"></i>Técnico:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.tecnico_id.name"/>
                                                </span>
                                            </div>
                                            
                                            <div class="info-item" t-if="service.contacto">
                                                <span class="info-label">
                                                    <i class="bi bi-person-badge me-1"></i>Reportó:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.contacto"/>
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="info-item" t-if="service.fecha_programada">
                                                <span class="info-label">
                                                    <i class="bi bi-clock me-1"></i>Programado:
                                                </span>
                                                <span class="info-value">
                                                    <span t-field="service.fecha_programada" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                                </span>
                                            </div>
                                            
                                            <div class="info-item" t-if="service.duracion_real">
                                                <span class="info-label">
                                                    <i class="bi bi-hourglass me-1"></i>Duración:
                                                </span>
                                                <span class="info-value">
                                                    <span t-esc="'%.1f' % service.duracion_real"/> hrs
                                                </span>
                                            </div>
                                            
                                            <div class="info-item" t-if="service.sla_cumplido and service.estado == 'completado'">
                                                <span class="info-label">
                                                    <i class="bi bi-speedometer me-1"></i>SLA:
                                                </span>
                                                <span class="info-value text-success">
                                                    ✓ Cumplido
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Problema reportado -->
                                    <div class="mt-3 p-3 bg-light rounded">
                                        <small class="text-muted fw-semibold d-block mb-2">
                                            <i class="bi bi-chat-left-text me-1"></i>Problema:
                                        </small>
                                        <p class="mb-0 text-dark" t-field="service.problema_reportado"/>
                                    </div>
                                </div>
                                
                                <!-- Footer -->
                                <div class="service-footer" onclick="event.stopPropagation();">
                                    <small class="text-muted">
                                        <i class="bi bi-hash"></i>
                                        <span t-field="service.name"/>
                                    </small>
                                    <a t-attf-href="/my/copier/service/#{service.id}" 
                                       class="btn btn-sm btn-primary">
                                        <i class="bi bi-eye me-1"></i>Ver Detalle
                                    </a>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </t>
            
            <!-- Botón volver -->
            <div class="text-center mt-4 mb-4">
                <a t-att-href="'/my/copier/equipment/%s' % equipment.id" 
                   class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-arrow-left me-2"></i>
                    Volver al Equipo
                </a>
            </div>
        </div>
    </t>
</template>
<!-- ============================================================
     NUEVO TEMPLATE: DETALLE DE UN SERVICIO TÉCNICO
     ============================================================ -->
<template id="portal_my_copier_service_detail" name="Service Detail">
    <t t-call="portal.portal_layout">
        <t t-set="breadcrumbs_searchbar" t-value="True"/>
        
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap');
            @import url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css');
            
            .service-detail-hero {
                background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
                color: white;
                border-radius: 0 0 30px 30px;
                margin: -20px -15px 30px;
                padding: 40px 15px;
            }
            
            .detail-card {
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                border: 1px solid #e5e7eb;
                margin-bottom: 20px;
            }
            
            .detail-card-header {
                background: linear-gradient(135deg, #f8fafc, #e2e8f0);
                padding: 20px;
                border-bottom: 2px solid #e5e7eb;
                border-radius: 16px 16px 0 0;
            }
            
            .detail-card-body {
                padding: 20px;
            }
            
            .info-row {
                display: flex;
                justify-content: space-between;
                padding: 12px 0;
                border-bottom: 1px solid #f3f4f6;
            }
            
            .info-row:last-child {
                border-bottom: none;
            }
            
            .info-label {
                color: #6b7280;
                font-weight: 500;
            }
            
            .info-value {
                color: #111827;
                font-weight: 600;
                text-align: right;
            }
            
            .timeline {
                position: relative;
                padding-left: 30px;
            }
            
            .timeline-item {
                position: relative;
                padding-bottom: 20px;
            }
            
            .timeline-item::before {
                content: '';
                position: absolute;
                left: -22px;
                top: 0;
                width: 12px;
                height: 12px;
                border-radius: 50%;
                background: #8b5cf6;
                border: 3px solid white;
                box-shadow: 0 0 0 2px #8b5cf6;
            }
            
            .timeline-item::after {
                content: '';
                position: absolute;
                left: -17px;
                top: 12px;
                width: 2px;
                height: 100%;
                background: #e5e7eb;
            }
            
            .timeline-item:last-child::after {
                display: none;
            }
        </style>
        
        <!-- Hero -->
        <div class="service-detail-hero">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="display-6 fw-bold mb-2">
                            <i class="bi bi-tools me-3"></i>
                            <span t-field="service.name"/>
                        </h1>
                        <p class="lead mb-0 opacity-90">
                            <span t-field="service.tipo_problema_id.name"/>
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <!-- Estado -->
                        <span t-if="service.estado == 'nuevo'" class="badge bg-info text-white fs-6 px-3 py-2">
                            <i class="bi bi-circle-fill me-1"></i>Nuevo
                        </span>
                        <span t-elif="service.estado == 'asignado'" class="badge bg-primary text-white fs-6 px-3 py-2">
                            <i class="bi bi-person-check me-1"></i>Asignado
                        </span>
                        <span t-elif="service.estado == 'confirmado'" class="badge bg-warning text-dark fs-6 px-3 py-2">
                            <i class="bi bi-calendar-check me-1"></i>Confirmado
                        </span>
                        <span t-elif="service.estado == 'en_ruta'" class="badge text-white fs-6 px-3 py-2" style="background: #8b5cf6;">
                            <i class="bi bi-truck me-1"></i>En Ruta
                        </span>
                        <span t-elif="service.estado == 'en_sitio'" class="badge bg-warning text-dark fs-6 px-3 py-2">
                            <i class="bi bi-tools me-1"></i>En Sitio
                        </span>
                        <span t-elif="service.estado == 'pausado'" class="badge bg-secondary text-white fs-6 px-3 py-2">
                            <i class="bi bi-pause-circle me-1"></i>Pausado
                        </span>
                        <span t-elif="service.estado == 'completado'" class="badge bg-success text-white fs-6 px-3 py-2">
                            <i class="bi bi-check-circle me-1"></i>Completado
                        </span>
                        <span t-elif="service.estado == 'cancelado'" class="badge bg-danger text-white fs-6 px-3 py-2">
                            <i class="bi bi-x-circle me-1"></i>Cancelado
                        </span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <div class="row">
                <!-- Información del Servicio -->
                <div class="col-lg-8 mb-4">
                    <!-- Detalles del Problema -->
                    <div class="detail-card">
                        <div class="detail-card-header">
                            <h5 class="fw-bold mb-0 text-primary">
                                <i class="bi bi-info-circle me-2"></i>
                                Detalles del Problema
                            </h5>
                        </div>
                        <div class="detail-card-body">
                            <div class="info-row">
                                <span class="info-label">Tipo de Problema:</span>
                                <span class="info-value" t-field="service.tipo_problema_id.name"/>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Prioridad:</span>
                                <span class="info-value">
                                    <span t-if="service.prioridad == '3'" class="badge bg-danger">🔴 Crítica</span>
                                    <span t-elif="service.prioridad == '2'" class="badge bg-warning text-dark">🟠 Alta</span>
                                    <span t-elif="service.prioridad == '1'" class="badge bg-info">🔵 Normal</span>
                                    <span t-else="" class="badge bg-secondary">⚪ Baja</span>
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Origen:</span>
                                <span class="info-value">
                                    <span t-if="service.origen_solicitud == 'whatsapp'">📱 WhatsApp/QR</span>
                                    <span t-elif="service.origen_solicitud == 'portal'">🌐 Portal Web</span>
                                    <span t-elif="service.origen_solicitud == 'telefono'">📞 Teléfono</span>
                                    <span t-elif="service.origen_solicitud == 'email'">📧 Email</span>
                                    <span t-else="">🏢 Interno</span>
                                </span>
                            </div>
                            
                            <div class="mt-4 p-4 bg-light rounded">
                                <h6 class="fw-semibold mb-3 text-dark">
                                    <i class="bi bi-chat-left-text me-2"></i>Descripción del Problema:
                                </h6>
                                <p class="mb-0 text-dark" style="white-space: pre-wrap;" t-field="service.problema_reportado"/>
                            </div>
                            
                            <!-- Foto antes (si existe) -->
                            <div class="mt-4" t-if="service.foto_antes">
                                <h6 class="fw-semibold mb-3 text-dark">
                                    <i class="bi bi-camera me-2"></i>Fotografía del Problema:
                                </h6>
                                <img class="img-fluid rounded shadow-sm" 
                                     t-att-src="image_data_uri(service.foto_antes)" 
                                     alt="Foto del problema"
                                     style="max-height: 400px;"/>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trabajo Realizado (si está completado) -->
                    <div class="detail-card" t-if="service.estado == 'completado' and service.trabajo_realizado">
                        <div class="detail-card-header">
                            <h5 class="fw-bold mb-0 text-success">
                                <i class="bi bi-check2-square me-2"></i>
                                Trabajo Realizado
                            </h5>
                        </div>
                        <div class="detail-card-body">
                            <div class="p-4 bg-light rounded">
                                <p class="mb-0 text-dark" style="white-space: pre-wrap;" t-field="service.trabajo_realizado"/>
                            </div>
                            
                            <!-- Foto después (si existe) -->
                            <div class="mt-4" t-if="service.foto_despues">
                                <h6 class="fw-semibold mb-3 text-dark">
                                    <i class="bi bi-camera me-2"></i>Fotografía Post-Servicio:
                                </h6>
                                <img class="img-fluid rounded shadow-sm" 
                                     t-att-src="image_data_uri(service.foto_despues)" 
                                     alt="Foto después del servicio"
                                     style="max-height: 400px;"/>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar con información adicional -->
                <div class="col-lg-4">
                    <!-- Información del Equipo -->
                    <div class="detail-card">
                        <div class="detail-card-header">
                            <h6 class="fw-bold mb-0 text-dark">
                                <i class="bi bi-printer me-2"></i>
                                Equipo
                            </h6>
                        </div>
                        <div class="detail-card-body">
                            <div class="info-row">
                                <span class="info-label">Modelo:</span>
                                <span class="info-value" t-field="service.modelo_maquina.name"/>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Serie:</span>
                                <span class="info-value" t-field="service.serie_maquina"/>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Ubicación:</span>
                                <span class="info-value" t-field="service.ubicacion"/>
                            </div>
                            <div class="info-row" t-if="service.sede">
                                <span class="info-label">Sede:</span>
                                <span class="info-value" t-field="service.sede"/>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Información del Contacto -->
                    <div class="detail-card">
                        <div class="detail-card-header">
                            <h6 class="fw-bold mb-0 text-dark">
                                <i class="bi bi-person me-2"></i>
                                Contacto
                            </h6>
                        </div>
                        <div class="detail-card-body">
                            <div class="info-row" t-if="service.contacto">
                                <span class="info-label">Nombre:</span>
                                <span class="info-value" t-field="service.contacto"/>
                            </div>
                            <div class="info-row" t-if="service.correo">
                                <span class="info-label">Email:</span>
                                <span class="info-value">
                                    <a t-att-href="'mailto:%s' % service.correo" t-field="service.correo"/>
                                </span>
                            </div>
                            <div class="info-row" t-if="service.telefono_contacto">
                                <span class="info-label">Teléfono:</span>
                                <span class="info-value" t-field="service.telefono_contacto"/>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Información del Técnico -->
                    <div class="detail-card" t-if="service.tecnico_id">
                        <div class="detail-card-header">
                            <h6 class="fw-bold mb-0 text-dark">
                                <i class="bi bi-person-badge me-2"></i>
                                Técnico Asignado
                            </h6>
                        </div>
                        <div class="detail-card-body">
                            <div class="text-center mb-3">
                                <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" 
                                     style="width: 60px; height: 60px;">
                                    <i class="bi bi-person-fill fs-3"></i>
                                </div>
                            </div>
                            <h6 class="text-center fw-bold text-dark mb-3" t-field="service.tecnico_id.name"/>
                            <div class="info-row" t-if="service.fecha_programada">
                                <span class="info-label">Fecha programada:</span>
                                <span class="info-value">
                                    <span t-field="service.fecha_programada" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Timeline del Servicio -->
                    <div class="detail-card">
                        <div class="detail-card-header">
                            <h6 class="fw-bold mb-0 text-dark">
                                <i class="bi bi-clock-history me-2"></i>
                                Historial
                            </h6>
                        </div>
                        <div class="detail-card-body">
                            <div class="timeline">
                                <div class="timeline-item">
                                    <small class="text-muted">Creado</small>
                                    <div class="fw-semibold">
                                        <span t-field="service.create_date" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                    </div>
                                </div>
                                
                                <div class="timeline-item" t-if="service.fecha_inicio">
                                    <small class="text-muted">Iniciado</small>
                                    <div class="fw-semibold">
                                        <span t-field="service.fecha_inicio" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                    </div>
                                </div>
                                
                                <div class="timeline-item" t-if="service.fecha_fin">
                                    <small class="text-muted">Completado</small>
                                    <div class="fw-semibold">
                                        <span t-field="service.fecha_fin" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm'}"/>
                                    </div>
                                </div>
                                
                                <div class="timeline-item" t-if="service.duracion_real">
                                    <small class="text-muted">Duración total</small>
                                    <div class="fw-semibold">
                                        <span t-esc="'%.1f' % service.duracion_real"/> horas
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Botón volver -->
            <div class="text-center mt-4 mb-4">
                <a t-att-href="'/my/copier/equipment/%s/services' % service.maquina_id.id" 
                   class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-arrow-left me-2"></i>
                    Volver a Servicios
                </a>
            </div>
        </div>
    </t>
</template>
</odoo>