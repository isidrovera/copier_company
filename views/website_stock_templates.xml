<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <template id="copier_stock" name="Stock de Fotocopiadoras">
        <t t-call="website.layout">
          <div class="container mt-4">
            <h1 class="mb-4">Stock de Fotocopiadoras</h1>
            <!-- Botones de toggle -->
            <div class="btn-group mb-3" role="group" aria-label="Vista">
              <button id="btn-list-view" type="button" class="btn btn-outline-primary active">Lista</button>
              <button id="btn-kanban-view" type="button" class="btn btn-outline-primary">Kanban</button>
            </div>
            <!-- Vista Lista -->
            <div id="list-view" class="table-responsive">
              <table class="table table-striped table-hover">
                <thead class="thead-light">
                  <tr>
                    <th>Imagen</th>
                    <th>Nombre</th>
                    <th>Modelo</th>
                    <th>Serie</th>
                    <th>Estado</th>
                    <th>Acci贸n</th>
                  </tr>
                </thead>
                <tbody>
                  <t t-foreach="machines" t-as="machine">
                    <tr>
                      <td>
                        <img t-att-src="'data:image/png;base64,%s' % (machine.modelo_id.imagen or '')"
                             class="img-thumbnail" style="max-width: 80px;" alt="Imagen"/>
                      </td>
                      <td><t t-esc="machine.name"/></td>
                      <td><t t-esc="machine.modelo_id.name"/></td>
                      <td><t t-esc="machine.serie"/></td>
                      <td>
                        <span t-att-class="'badge ' + (machine.state == 'available' and 'badge-success' or 'badge-secondary')">
                          <t t-esc="machine.state.capitalize()"/>
                        </span>
                      </td>
                      <td>
                        <a t-att-href="'/stock-maquinas/%s' % machine.id" class="btn btn-sm btn-primary">
                          Ver detalle
                        </a>
                      </td>
                    </tr>
                  </t>
                </tbody>
              </table>
            </div>
            <!-- Vista Kanban -->
            <div id="kanban-view" class="row d-none">
              <t t-foreach="machines" t-as="machine">
                <div class="col-md-4 mb-4">
                  <div class="card h-100 shadow-sm">
                    <img t-att-src="'data:image/png;base64,%s' % (machine.modelo_id.imagen or '')"
                         class="card-img-top" style="object-fit: cover; height: 200px;" alt="Imagen"/>
                    <div class="card-body d-flex flex-column">
                      <h5 class="card-title"><t t-esc="machine.name"/></h5>
                      <p class="mb-1"><strong>Modelo:</strong> <t t-esc="machine.modelo_id.name"/></p>
                      <p class="mb-1"><strong>Serie:</strong> <t t-esc="machine.serie"/></p>
                      <div class="mt-auto">
                        <span t-att-class="'badge ' + (machine.state == 'available' and 'badge-success' or 'badge-secondary')">
                          <t t-esc="machine.state.capitalize()"/>
                        </span>
                        <a t-att-href="'/stock-maquinas/%s' % machine.id" class="btn btn-sm btn-outline-primary float-right">
                          Ver detalle
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </t>
            </div>
          </div>
          <!-- Script para toggle entre vistas -->
          <script>
            document.addEventListener('DOMContentLoaded', function() {
              var btnList = document.getElementById('btn-list-view');
              var btnKanban = document.getElementById('btn-kanban-view');
              var listView = document.getElementById('list-view');
              var kanbanView = document.getElementById('kanban-view');
              btnList.addEventListener('click', function() {
                btnList.classList.add('active');
                btnKanban.classList.remove('active');
                listView.classList.remove('d-none');
                kanbanView.classList.add('d-none');
              });
              btnKanban.addEventListener('click', function() {
                btnKanban.classList.add('active');
                btnList.classList.remove('active');
                kanbanView.classList.remove('d-none');
                listView.classList.add('d-none');
              });
            });
          </script>
        </t>
      </template>
      
        <template id="copier_detail" name="Detalle de Fotocopiadora">
          <t t-call="website.layout">
            <div class="container mt-4">
              <h1>Fotocopiadora <t t-esc="machine.name"/></h1>
              <div class="row">
                <div class="col-6">
                  <img t-att-src="'data:image/png;base64,%s' % (machine.modelo_id.imagen or '')"
                       class="img-fluid" alt="Imagen"/>
                  <ul class="list-group mt-3">
                    <li class="list-group-item"><strong>Modelo:</strong> <t t-esc="machine.modelo_id.name"/></li>
                    <li class="list-group-item"><strong>Serie:</strong> <t t-esc="machine.serie"/></li>
                    <li class="list-group-item"><strong>Color (cont贸metro):</strong> <t t-esc="machine.contometro_color"/></li>
                    <li class="list-group-item"><strong>B/N (cont贸metro):</strong> <t t-esc="machine.contometro_bn"/></li>
                  </ul>
                </div>
                <div class="col-6">
                  <t t-if="machine.state == 'available'">
                    <form t-att-action="'/stock-maquinas/%s/reserve' % machine.id" method="post" enctype="multipart/form-data">
                      <div class="form-group">
                        <label for="payment_proof">Comprobante de Pago:</label>
                        <input type="file" name="payment_proof" class="form-control" required="1"/>
                      </div>
                      <button type="submit" class="btn btn-success mt-2">Reservar y subir comprobante</button>
                    </form>
                  </t>
                  <t t-elif="machine.state == 'reserved'">
                    <p class="text-warning">Reservada por ti. Esperando confirmaci贸n de venta.</p>
                  </t>
                  <t t-else="">
                    <p class="text-success">Vendida el <t t-esc="machine.sold_date"/></p>
                  </t>
                </div>
              </div>
            </div>
          </t>
        </template>
    
</odoo>