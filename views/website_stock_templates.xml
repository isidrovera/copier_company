<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Plantilla para listado de máquinas -->
  <!-- Plantilla mejorada para listado de máquinas -->
<template id="copier_list" name="Listado de Fotocopiadoras">
    <t t-call="website.layout">
      <div class="container mt-4">
        <h1 class="mb-4">
          <i class="fa fa-print text-primary mr-2"></i>Stock de Fotocopiadoras
        </h1>
  
        <!-- Filtros -->
        <div class="card mb-4 shadow-sm">
          <div class="card-header bg-light">
            <h5 class="mb-0">
              <i class="fa fa-filter text-muted mr-2"></i>Filtros
            </h5>
          </div>
          <div class="card-body">
            <form action="/stock-maquinas" method="get" class="row">
              <div class="col-md-4 col-sm-6 mb-3">
                <label for="marca">
                  <i class="fa fa-tag mr-1"></i>Marca:
                </label>
                <select id="marca" name="marca" class="form-control">
                  <option value="">Todas las marcas</option>
                  <t t-foreach="marcas" t-as="marca">
                    <option t-att-value="marca.id"
                            t-att-selected="marca.id == (selected_marca or 0)">
                      <t t-esc="marca.name"/>
                    </option>
                  </t>
                </select>
              </div>
              <div class="col-md-4 col-sm-6 mb-3">
                <label for="tipo">
                  <i class="fa fa-cog mr-1"></i>Tipo:
                </label>
                <select id="tipo" name="tipo" class="form-control">
                  <option value="">Todos los tipos</option>
                  <option value="monocroma" t-att-selected="selected_tipo == 'monocroma'">Monocroma</option>
                  <option value="color" t-att-selected="selected_tipo == 'color'">Color</option>
                </select>
              </div>
              <div class="col-md-4 col-sm-12 mb-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary">
                  <i class="fa fa-search mr-1"></i>Filtrar
                </button>
                <a href="/stock-maquinas" class="btn btn-outline-secondary ml-2">
                  <i class="fa fa-times mr-1"></i>Limpiar
                </a>
              </div>
            </form>
          </div>
        </div>
  
        <!-- Botones de toggle con iconos -->
        <div class="btn-group mb-3" role="group" aria-label="Vista">
          <button id="btn-list-view" type="button" class="btn btn-outline-primary active">
            <i class="fa fa-list mr-1"></i><span class="d-none d-sm-inline">Lista</span>
          </button>
          <button id="btn-kanban-view" type="button" class="btn btn-outline-primary">
            <i class="fa fa-th-large mr-1"></i><span class="d-none d-sm-inline">Tarjetas</span>
          </button>
        </div>
  
        <!-- Vista Lista -->
        <div id="list-view" class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="thead-light">
              <tr>
                <th>Imagen</th>
                <th>Referencia</th>
                <th>Marca / Modelo</th>
                <th class="d-none d-md-table-cell">Tipo</th>
                <th class="d-none d-md-table-cell">Contómetro</th>
                <th>Precio</th>
                <th>Acción</th>
              </tr>
            </thead>
            <tbody>
              <t t-if="not machines">
                <tr>
                  <td colspan="7" class="text-center py-4">
                    <div class="alert alert-info mb-0">
                      <i class="fa fa-info-circle mr-2"></i>No hay máquinas disponibles con los filtros seleccionados.
                    </div>
                  </td>
                </tr>
              </t>
              <t t-foreach="machines" t-as="machine">
                <tr>
                  <td>
                    <img class="img-thumbnail" style="max-width:80px; max-height:60px; object-fit:contain;"
                         t-att-src="'data:image/png;base64,%s' % (machine.image or machine.modelo_id.imagen)"
                         alt="Imagen"/>
                  </td>
                  <td><t t-esc="machine.name"/></td>
                  <td>
                    <t t-esc="machine.marca_id.name"/> /
                    <t t-esc="machine.modelo_id.name"/>
                  </td>
                  <td class="d-none d-md-table-cell">
                    <span t-if="machine.tipo == 'monocroma'" class="badge badge-secondary">
                      <i class="fa fa-adjust mr-1"></i>Monocroma
                    </span>
                    <span t-else="" class="badge badge-info">
                      <i class="fa fa-palette mr-1"></i>Color
                    </span>
                  </td>
                  <td class="d-none d-md-table-cell">
                    <t t-if="machine.tipo == 'monocroma'">
                      <i class="fa fa-print text-secondary mr-1"></i><t t-esc="machine.contometro_bn"/> B/N
                    </t>
                    <t t-else="">
                      <i class="fa fa-print text-secondary mr-1"></i><t t-esc="machine.contometro_bn"/> B/N /
                      <i class="fa fa-print text-primary mr-1"></i><t t-esc="machine.contometro_color"/> Color
                    </t>
                  </td>
                  <td>
                    <span class="badge badge-success">
                      <i class="fa fa-tag mr-1"></i><t t-esc="machine.sale_price"/> €
                    </span>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <!-- Detalles sigue como enlace GET -->
                      <a t-att-href="'/stock-maquinas/%s' % machine.id"
                         class="btn btn-outline-secondary">
                         <i class="fa fa-eye"></i>
                         <span class="d-none d-lg-inline ml-1">Detalles</span>
                      </a>
                    
                      <!-- Reservar: formulario que envía POST -->
                      <t t-if="machine.state == 'available'">
                        <form t-att-action="'/stock-maquinas/%s/reserve' % machine.id"
                              method="post" style="display:inline;">
                          <!-- token CSRF obligatorio -->
                          <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                          <button type="submit" class="btn btn-primary ml-1">
                            <i class="fa fa-calendar-check"></i>
                            <span class="d-none d-lg-inline ml-1">Reservar</span>
                          </button>
                        </form>
                      </t>
                    </div>
                  </td>
                </tr>
              </t>
            </tbody>
          </table>
        </div>
  
        <!-- Vista Kanban -->
        <div id="kanban-view" class="row" style="display:none">
          <t t-if="not machines">
            <div class="col-12">
              <div class="alert alert-info text-center">
                <i class="fa fa-info-circle mr-2"></i>No hay máquinas disponibles con los filtros seleccionados.
              </div>
            </div>
          </t>
          <t t-foreach="machines" t-as="machine">
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
              <div class="card h-100 shadow-sm hover-shadow transition">
                <div class="position-relative">
                  <img class="card-img-top p-3" style="height: 200px; object-fit: contain;"
                       t-att-src="'data:image/png;base64,%s' % (machine.image or machine.modelo_id.imagen)"
                       alt="Imagen"/>
                  <div class="position-absolute" style="top: 10px; right: 10px;">
                    <span t-if="machine.tipo == 'monocroma'" class="badge badge-secondary">
                      <i class="fa fa-adjust mr-1"></i>Monocroma
                    </span>
                    <span t-else="" class="badge badge-info">
                      <i class="fa fa-palette mr-1"></i>Color
                    </span>
                  </div>
                </div>
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">
                    <i class="fa fa-barcode text-muted mr-2"></i><t t-esc="machine.name"/>
                  </h5>
                  <p class="card-text mb-1">
                    <i class="fa fa-tag text-muted mr-1"></i>
                    <strong>Marca/Modelo:</strong>
                    <t t-esc="machine.marca_id.name"/> /
                    <t t-esc="machine.modelo_id.name"/>
                  </p>
                  <p class="card-text mb-1">
                    <i class="fa fa-print text-muted mr-1"></i>
                    <strong>Contómetro:</strong>
                    <t t-if="machine.tipo=='monocroma'">
                      <t t-esc="machine.contometro_bn"/> B/N
                    </t>
                    <t t-else="">
                      <t t-esc="machine.contometro_bn"/> B/N /
                      <t t-esc="machine.contometro_color"/> Color
                    </t>
                  </p>
                  <p class="card-text mb-3">
                    <i class="fa fa-euro-sign text-success mr-1"></i>
                    <strong>Precio:</strong>
                    <span class="badge badge-success p-2">
                      <t t-esc="machine.sale_price"/> €
                    </span>
                  </p>
                  <div class="mt-auto">
                    <!-- Enlace GET para detalles -->
                    <a t-att-href="'/stock-maquinas/%s' % machine.id"
                       class="btn btn-outline-secondary btn-block mb-2">
                       <i class="fa fa-eye mr-1"></i>Detalles
                    </a>
                  
                    <!-- Formulario POST para reservar -->
                    <t t-if="machine.state == 'available'">
                      <form t-att-action="'/stock-maquinas/%s/reserve' % machine.id"
                            method="post" class="d-block">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <button type="submit" class="btn btn-primary btn-block">
                          <i class="fa fa-calendar-check mr-1"></i>Reservar
                        </button>
                      </form>
                    </t>
                  </div>
                </div>
                <div class="card-footer bg-white">
                  <small class="text-muted">
                    <i class="fa fa-info-circle mr-1"></i>ID: <t t-esc="machine.id"/>
                  </small>
                </div>
              </div>
            </div>
          </t>
        </div>
      </div>
  
      <!-- CSS Personalizado -->
      <style>
        .hover-shadow:hover {
          box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
        .transition {
          transition: all 0.3s ease;
        }
        @media (max-width: 767px) {
          .btn-group-sm .btn {
            padding: 0.25rem 0.5rem;
          }
        }
      </style>
  
      <!-- Script para alternar vistas -->
      <script>
        document.getElementById('btn-list-view').addEventListener('click', function() {
          this.classList.add('active');
          document.getElementById('btn-kanban-view').classList.remove('active');
          document.getElementById('list-view').style.display = '';
          document.getElementById('kanban-view').style.display = 'none';
          localStorage.setItem('preferredView', 'list');
        });
        
        document.getElementById('btn-kanban-view').addEventListener('click', function() {
          this.classList.add('active');
          document.getElementById('btn-list-view').classList.remove('active');
          document.getElementById('kanban-view').style.display = '';
          document.getElementById('list-view').style.display = 'none';
          localStorage.setItem('preferredView', 'kanban');
        });
        
        // Restaurar la vista preferida del usuario
        document.addEventListener('DOMContentLoaded', function() {
          var preferredView = localStorage.getItem('preferredView');
          if (preferredView === 'kanban') {
            document.getElementById('btn-kanban-view').click();
          }
        });
      </script>
    </t>
  </template>

    
    <!-- Plantilla para "Mis Máquinas" -->
    <template id="my_machines" name="Mis Máquinas">
        <t t-call="website.layout">
            <div class="container mt-4">
                <h1 class="mb-4">Mis Máquinas</h1>
                
                <ul class="nav nav-tabs" id="myMachinesTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="reserved-tab" data-toggle="tab" href="#reserved" role="tab">
                            Reservadas <span class="badge badge-warning"><t t-esc="len(reserved_machines)"/></span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="purchased-tab" data-toggle="tab" href="#purchased" role="tab">
                            Compradas <span class="badge badge-success"><t t-esc="len(purchased_machines)"/></span>
                        </a>
                    </li>
                </ul>
                
                <div class="tab-content mt-4" id="myMachinesTabContent">
                    <!-- Pestaña de máquinas reservadas -->
                    <div class="tab-pane fade show active" id="reserved" role="tabpanel" aria-labelledby="reserved-tab">
                        <t t-if="not reserved_machines">
                            <div class="alert alert-info">
                                <i class="fa fa-info-circle mr-2"></i> No tiene máquinas reservadas actualmente.
                            </div>
                        </t>
                        <t t-else="">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Referencia</th>
                                            <th>Marca/Modelo</th>
                                            <th>Estado</th>
                                            <th>Fecha de Reserva</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="reserved_machines" t-as="machine">
                                            <tr>
                                                <td><t t-esc="machine.name"/></td>
                                                <td><t t-esc="machine.marca_id.name"/> <t t-esc="machine.modelo_id.name"/></td>
                                                <td>
                                                    <span t-att-class="'badge ' + (machine.state == 'reserved' and 'badge-warning' or 'badge-info')">
                                                        <t t-esc="dict(machine._fields['state'].selection).get(machine.state)"/>
                                                    </span>
                                                </td>
                                                <td><t t-esc="machine.reserved_date" t-options="{'widget': 'datetime'}"/></td>
                                                <td>
                                                    <a t-att-href="'/stock-maquinas/%s' % machine.id" class="btn btn-sm btn-outline-primary mr-1">
                                                        Ver detalles
                                                    </a>
                                                    <a t-att-href="'/stock-maquinas/%s/payment' % machine.id" class="btn btn-sm btn-primary">
                                                        Subir pago
                                                    </a>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </t>
                    </div>
                    
                    <!-- Pestaña de máquinas compradas -->
                    <div class="tab-pane fade" id="purchased" role="tabpanel" aria-labelledby="purchased-tab">
                        <t t-if="not purchased_machines">
                            <div class="alert alert-info">
                                <i class="fa fa-info-circle mr-2"></i> No tiene máquinas compradas actualmente.
                            </div>
                        </t>
                        <t t-else="">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Referencia</th>
                                            <th>Marca/Modelo</th>
                                            <th>Fecha de Compra</th>
                                            <th>Precio</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="purchased_machines" t-as="machine">
                                            <tr>
                                                <td><t t-esc="machine.name"/></td>
                                                <td><t t-esc="machine.marca_id.name"/> <t t-esc="machine.modelo_id.name"/></td>
                                                <td><t t-esc="machine.sold_date" t-options="{'widget': 'datetime'}"/></td>
                                                <td>
                                                    <t t-if="machine.sale_price">
                                                        <t t-esc="machine.sale_price"/> €
                                                    </t>
                                                    <t t-else="">
                                                        -
                                                    </t>
                                                </td>
                                                <td>
                                                    <a t-att-href="'/stock-maquinas/%s' % machine.id" class="btn btn-sm btn-outline-primary">
                                                        Ver detalles
                                                    </a>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>

    
    <!-- Plantilla para el detalle de una máquina -->
    <template id="copier_detail" name="Detalle de Fotocopiadora">
        <t t-call="website.layout">
          <div class="container py-5">
            <!-- Migas de pan con iconos -->
            <nav aria-label="breadcrumb" class="mb-4">
              <ol class="breadcrumb bg-light p-3 rounded shadow-sm">
                <li class="breadcrumb-item">
                  <a href="/stock-maquinas" class="text-decoration-none">
                    <i class="fa fa-home me-1"></i> Stock de Fotocopiadoras
                  </a>
                </li>
                <li class="breadcrumb-item active fw-bold" aria-current="page">
                  <i class="fa fa-print me-1"></i> <t t-esc="machine.name"/>
                </li>
              </ol>
            </nav>
      
            <div class="card shadow border-0 overflow-hidden">
              <!-- Cabecera con degradado -->
              <div class="card-header bg-gradient-primary text-white d-flex justify-content-between align-items-center p-3">
                <h2 class="mb-0 d-flex align-items-center">
                  <i class="fa fa-copy me-2"></i> Fotocopiadora <t t-esc="machine.name"/>
                </h2>
                <span t-att-class="'badge rounded-pill fw-bold fs-6 ' + (
                      machine.state == 'available'       and 'bg-success' or
                      machine.state == 'reserved'        and 'bg-warning' or
                      machine.state == 'pending_payment' and 'bg-info'    or
                      'bg-secondary')">
                  <t t-if="machine.state == 'available'"><i class="fa fa-check-circle me-1"></i></t>
                  <t t-elif="machine.state == 'reserved'"><i class="fa fa-clock me-1"></i></t>
                  <t t-elif="machine.state == 'pending_payment'"><i class="fa fa-money-bill me-1"></i></t>
                  <t t-else=""><i class="fa fa-ban me-1"></i></t>
                  <t t-esc="dict(machine._fields['state'].selection).get(machine.state)"/>
                </span>
              </div>
      
              <!-- Cuerpo -->
              <div class="card-body p-4">
                <div class="row g-4">
                  <!-- Carrusel de imágenes mejorado -->
                  <div class="col-lg-6 mb-4">
                    <div class="card shadow-sm border-0 h-100">
                      <div class="card-body p-0">
                        <div id="machineImages" class="carousel slide" data-bs-ride="carousel">
                          <div class="carousel-inner rounded">
                            <!-- Imagen principal / modelo / placeholder -->
                            <t t-if="machine.image">
                              <div class="carousel-item active">
                                <div class="position-relative">
                                  <img
                                    t-att-src="'data:image/png;base64,%s' % machine.image"
                                    class="d-block w-100"
                                    style="height:400px;object-fit:contain;"
                                    alt="Imagen principal"/>
                                  <div class="position-absolute bottom-0 start-0 w-100 p-2 bg-dark bg-opacity-50 text-white">
                                    <small><i class="fa fa-camera me-1"></i> Imagen principal</small>
                                  </div>
                                </div>
                              </div>
                            </t>
                            <t t-elif="machine.modelo_id and machine.modelo_id.imagen">
                              <div class="carousel-item active">
                                <div class="position-relative">
                                  <img
                                    t-att-src="'data:image/png;base64,%s' % machine.modelo_id.imagen"
                                    class="d-block w-100"
                                    style="height:400px;object-fit:contain;"
                                    alt="Imagen modelo"/>
                                  <div class="position-absolute bottom-0 start-0 w-100 p-2 bg-dark bg-opacity-50 text-white">
                                    <small><i class="fa fa-camera me-1"></i> Imagen modelo</small>
                                  </div>
                                </div>
                              </div>
                            </t>
                            <t t-else="">
                              <div class="carousel-item active">
                                <div class="position-relative">
                                  <img
                                    src="/copier_company/static/src/img/no_image.png"
                                    class="d-block w-100"
                                    style="height:400px;object-fit:contain;"
                                    alt="Sin imagen"/>
                                  <div class="position-absolute bottom-0 start-0 w-100 p-2 bg-dark bg-opacity-50 text-white">
                                    <small><i class="fa fa-image me-1"></i> Sin imagen</small>
                                  </div>
                                </div>
                              </div>
                            </t>
      
                            <!-- Imágenes adicionales -->
                            <t t-foreach="machine.image_ids" t-as="img" t-index="idx">
                              <div class="carousel-item">
                                <div class="position-relative">
                                  <img
                                    t-att-src="'data:image/png;base64,%s' % img.image"
                                    class="d-block w-100"
                                    style="height:400px;object-fit:contain;"
                                    t-att-alt="img.name or 'Imagen adicional'"/>
                                  <div class="position-absolute bottom-0 start-0 w-100 p-2 bg-dark bg-opacity-50 text-white">
                                    <small><i class="fa fa-camera me-1"></i> <t t-esc="img.name or 'Imagen adicional'"/></small>
                                  </div>
                                </div>
                              </div>
                            </t>
                          </div>
      
                          <!-- Indicadores y controles si hay imágenes adicionales -->
                          <t t-if="machine.image_ids">
                            <div class="carousel-indicators">
                              <button type="button" data-bs-target="#machineImages" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                              <t t-foreach="machine.image_ids" t-as="img" t-index="idx">
                                <button
                                  type="button"
                                  data-bs-target="#machineImages"
                                  t-att-data-bs-slide-to="idx + 1"
                                  t-att-aria-label="'Slide ' + str(idx + 2)"></button>
                              </t>
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#machineImages" data-bs-slide="prev">
                              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Anterior</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#machineImages" data-bs-slide="next">
                              <span class="carousel-control-next-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Siguiente</span>
                            </button>
                          </t>
                        </div>
                      </div>
                    </div>
                  </div>
      
                  <!-- Datos principales -->
                  <div class="col-lg-6">
                    <h3 class="mb-3 d-flex align-items-center">
                      <i class="fa fa-tag me-2 text-primary"></i>
                      <t t-esc="machine.marca_id.name"/> <t t-esc="machine.modelo_id.name"/>
                    </h3>
      
                    <!-- Etiquetas -->
                    <div class="mb-4">
                      <span t-att-class="'badge rounded-pill me-2 fs-6 ' + (
                            machine.tipo == 'color' and 'bg-info' or 'bg-secondary')">
                        <i t-if="machine.tipo == 'color'" class="fa fa-palette me-1"></i>
                        <i t-else="" class="fa fa-adjust me-1"></i>
                        <t t-esc="dict(machine._fields['tipo'].selection).get(machine.tipo)"/>
                      </span>
                      <t t-if="machine.reparacion != 'none'">
                        <span t-att-class="'badge rounded-pill fs-6 ' + (
                              machine.reparacion == 'done'        and 'bg-success' or
                              machine.reparacion == 'in_progress' and 'bg-warning' or
                              'bg-danger')">
                          <i t-if="machine.reparacion == 'done'" class="fa fa-check-circle me-1"></i>
                          <i t-elif="machine.reparacion == 'in_progress'" class="fa fa-tools me-1"></i>
                          <i t-else="" class="fa fa-exclamation-triangle me-1"></i>
                          <t t-esc="dict(machine._fields['reparacion'].selection).get(machine.reparacion)"/>
                        </span>
                      </t>
                    </div>
      
                    <!-- Tabla de info con iconos -->
                    <div class="card border-0 shadow-sm mb-4">
                      <div class="card-body">
                        <table class="table table-hover mb-0">
                          <tbody>
                            <tr>
                              <th style="width:40%;"><i class="fa fa-hashtag text-primary me-2"></i> Referencia:</th>
                              <td class="fw-bold"><t t-esc="machine.name"/></td>
                            </tr>
                            <tr>
                              <th><i class="fa fa-barcode text-primary me-2"></i> N° de Serie:</th>
                              <td><t t-esc="machine.serie"/></td>
                            </tr>
                            <tr>
                              <th><i class="fa fa-print text-primary me-2"></i> Contómetro B/N:</th>
                              <td><span class="badge bg-light text-dark"><t t-esc="machine.contometro_bn"/> páginas</span></td>
                            </tr>
                            <t t-if="machine.tipo == 'color'">
                              <tr>
                                <th><i class="fa fa-palette text-primary me-2"></i> Contómetro Color:</th>
                                <td><span class="badge bg-light text-dark"><t t-esc="machine.contometro_color"/> páginas</span></td>
                              </tr>
                            </t>
                            <t t-if="machine.sale_price">
                              <tr>
                                <th><i class="fa fa-euro-sign text-primary me-2"></i> Precio:</th>
                                <td>
                                  <div class="d-flex align-items-center">
                                    <span class="fs-4 fw-bold text-primary"><t t-esc="machine.sale_price"/> €</span>
                                    <span class="ms-2 badge bg-success">
                                      <i class="fa fa-tag me-1"></i> Oferta
                                    </span>
                                  </div>
                                </td>
                              </tr>
                            </t>
                          </tbody>
                        </table>
                      </div>
                    </div>
      
                    <!-- Acciones -->
                    <div class="mt-4">
                      <t t-if="machine.state == 'available'">
                        <form t-att-action="'/stock-maquinas/%s/reserve' % machine.id" method="post">
                          <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                          <button type="submit" class="btn btn-success btn-lg w-100 mb-3 d-flex justify-content-center align-items-center">
                            <i class="fa fa-shopping-cart me-2"></i> Reservar Ahora
                          </button>
                        </form>
                        <div class="alert alert-info d-flex align-items-center" role="alert">
                          <i class="fa fa-info-circle me-2 fs-5"></i>
                          <div>Disponibilidad inmediata. ¡Reserve ahora antes de que se agote!</div>
                        </div>
                      </t>
                      <t t-elif="machine.state == 'reserved' and machine.reserved_by.id == user.partner_id.id">
                        <div class="alert alert-warning d-flex" role="alert">
                          <div class="flex-shrink-0"><i class="fa fa-exclamation-circle fs-2 me-3"></i></div>
                          <div>
                            <h5 class="alert-heading">¡Máquina reservada!</h5>
                            <p>Esta máquina está reservada por ti. Para completar la compra, sube el comprobante de pago.</p>
                            <a t-att-href="'/stock-maquinas/%s/payment' % machine.id" class="btn btn-primary mt-2">
                              <i class="fa fa-upload me-2"></i> Subir comprobante de pago
                            </a>
                          </div>
                        </div>
                      </t>
                      <t t-elif="machine.state == 'pending_payment' and machine.reserved_by.id == user.partner_id.id">
                        <div class="alert alert-info d-flex" role="alert">
                          <div class="flex-shrink-0"><i class="fa fa-clock fs-2 me-3"></i></div>
                          <div>
                            <h5 class="alert-heading">¡Casi tuya!</h5>
                            <p>Estamos verificando tu pago. Si necesitas subir un nuevo comprobante, puedes hacerlo aquí.</p>
                            <a t-att-href="'/stock-maquinas/%s/payment' % machine.id" class="btn btn-outline-primary mt-2">
                              <i class="fa fa-file-upload me-2"></i> Subir nuevo comprobante
                            </a>
                          </div>
                        </div>
                      </t>
                      <t t-elif="machine.state == 'sold' and machine.reserved_by.id == user.partner_id.id">
                        <div class="alert alert-success d-flex" role="alert">
                          <div class="flex-shrink-0"><i class="fa fa-check-circle fs-2 me-3"></i></div>
                          <div>
                            <h5 class="alert-heading">¡Compra completada!</h5>
                            <p>La fotocopiadora es tuya. Nuestro equipo se pondrá en contacto contigo para coordinar la entrega.</p>
                          </div>
                        </div>
                      </t>
                      <t t-elif="machine.state != 'available'">
                        <div class="alert alert-secondary d-flex" role="alert">
                          <div class="flex-shrink-0"><i class="fa fa-ban fs-2 me-3"></i></div>
                          <div>
                            <h5 class="alert-heading">No disponible</h5>
                            <p>Esta máquina no está disponible actualmente. Revisa otras opciones en nuestro catálogo.</p>
                            <a href="/stock-maquinas" class="btn btn-outline-secondary mt-2">
                              <i class="fa fa-search me-2"></i> Ver otras máquinas
                            </a>
                          </div>
                        </div>
                      </t>
                    </div>
                  </div>
                </div>
      
                <!-- Pestañas modernas -->
                <div class="card border-0 shadow-sm mt-5">
                  <div class="card-header bg-white">
                    <ul class="nav nav-tabs card-header-tabs" id="machineDetailTab" role="tablist">
                      <li class="nav-item">
                        <a class="nav-link active d-flex align-items-center" id="checklist-tab"
                           data-bs-toggle="tab" href="#checklist" role="tab" aria-controls="checklist" aria-selected="true">
                          <i class="fa fa-clipboard-check me-2"></i> Estado de la Máquina
                        </a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" id="accessories-tab"
                           data-bs-toggle="tab" href="#accessories" role="tab" aria-controls="accessories" aria-selected="false">
                          <i class="fa fa-puzzle-piece me-2"></i> Accesorios Incluidos
                        </a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" id="specs-tab"
                           data-bs-toggle="tab" href="#specs" role="tab" aria-controls="specs" aria-selected="false">
                          <i class="fa fa-cogs me-2"></i> Especificaciones
                        </a>
                      </li>
                    </ul>
                  </div>
      
                  <div class="card-body">
                    <div class="tab-content" id="machineDetailTabContent">
                      <!-- Checklist -->
                      <div class="tab-pane fade show active" id="checklist" role="tabpanel" aria-labelledby="checklist-tab">
                        <h4 class="mb-3 d-flex align-items-center">
                          <i class="fa fa-clipboard-list text-primary me-2"></i> Estado de los componentes
                        </h4>
                        <div class="table-responsive">
                          <table class="table table-hover">
                            <thead class="table-light">
                              <tr>
                                <th><i class="fa fa-cog me-1"></i> Componente</th>
                                <th><i class="fa fa-info-circle me-1"></i> Estado</th>
                                <th><i class="fa fa-comment me-1"></i> Observaciones</th>
                              </tr>
                            </thead>
                            <tbody>
                              <t t-foreach="machine.checklist_ids" t-as="check">
                                <tr>
                                  <td class="fw-bold"><t t-esc="check.name"/></td>
                                  <td>
                                    <span t-att-class="'badge rounded-pill ' + (
                                          check.state == 'good'      and 'bg-success' or
                                          check.state == 'regular'   and 'bg-warning' or
                                          check.state == 'poor'      and 'bg-danger'  or
                                          check.state == 'replaced'  and 'bg-info'    or
                                          'bg-secondary')">
                                      <t t-if="check.state == 'good'"><i class="fa fa-check me-1"></i></t>
                                      <t t-elif="check.state == 'regular'"><i class="fa fa-exclamation me-1"></i></t>
                                      <t t-elif="check.state == 'poor'"><i class="fa fa-times me-1"></i></t>
                                      <t t-elif="check.state == 'replaced'"><i class="fa fa-sync me-1"></i></t>
                                      <t t-esc="dict(check._fields['state'].selection).get(check.state)"/>
                                    </span>
                                  </td>
                                  <td><t t-esc="check.notes or '-'"/></td>
                                </tr>
                              </t>
                            </tbody>
                          </table>
                        </div>
                      </div>
      
                      <!-- Accesorios -->
                      <div class="tab-pane fade" id="accessories" role="tabpanel" aria-labelledby="accessories-tab">
                        <h4 class="mb-3 d-flex align-items-center">
                          <i class="fa fa-puzzle-piece text-primary me-2"></i> Accesorios incluidos con esta máquina
                        </h4>
                        <div class="row row-cols-1 row-cols-md-3 g-4">
                          <t t-if="not machine.accesorios_ids">
                            <div class="col-12">
                              <div class="alert alert-info d-flex align-items-center">
                                <i class="fa fa-info-circle me-2 fs-4"></i>
                                <div>Esta máquina no incluye accesorios adicionales.</div>
                              </div>
                            </div>
                          </t>
                          <t t-foreach="machine.accesorios_ids" t-as="accesorio">
                            <div class="col">
                              <div class="card h-100 border-0 shadow-sm hover-shadow">
                                <div class="card-body d-flex align-items-center">
                                  <i class="fa fa-puzzle-piece text-primary me-3 fs-3"></i>
                                  <h5 class="card-title mb-0"><t t-esc="accesorio.name"/></h5>
                                </div>
                              </div>
                            </div>
                          </t>
                        </div>
                      </div>
      
                      <!-- Especificaciones -->
                      <div class="tab-pane fade" id="specs" role="tabpanel" aria-labelledby="specs-tab">
                        <h4 class="mb-3 d-flex align-items-center">
                          <i class="fa fa-cogs text-primary me-2"></i> Especificaciones técnicas
                        </h4>
                        <div class="row g-4">
                          <div class="col-md-6">
                            <div class="card border-0 shadow-sm h-100">
                              <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="fa fa-print me-2"></i> Características de impresión</h5>
                              </div>
                              <div class="card-body">
                                <ul class="list-group list-group-flush">
                                  <li class="list-group-item d-flex">
                                    <i class="fa fa-tachometer-alt text-primary me-2 mt-1"></i>
                                    <div>
                                      <strong>Velocidad de impresión:</strong>
                                      <p class="mb-0">30-40 ppm (estimado)</p>
                                    </div>
                                  </li>
                                  <li class="list-group-item d-flex">
                                    <i class="fa fa-expand-arrows-alt text-primary me-2 mt-1"></i>
                                    <div>
                                      <strong>Formato máximo:</strong>
                                      <p class="mb-0">A3 (estimado)</p>
                                    </div>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="card border-0 shadow-sm h-100">
                              <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="fa fa-network-wired me-2"></i> Conectividad</h5>
                              </div>
                              <div class="card-body">
                                <ul class="list-group list-group-flush">
                                  <li class="list-group-item d-flex">
                                    <i class="fa fa-wifi text-primary me-2 mt-1"></i>
                                    <div>
                                      <strong>Conexión de red:</strong>
                                      <p class="mb-0">Ethernet 10/100/1000</p>
                                    </div>
                                  </li>
                                  <li class="list-group-item d-flex">
                                    <i class="fa fa-usb text-primary me-2 mt-1"></i>
                                    <div>
                                      <strong>Conexión local:</strong>
                                      <p class="mb-0">USB 2.0/3.0</p>
                                    </div>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
      
                  <!-- Call to action -->
                  <div class="alert alert-primary mt-4 d-md-flex justify-content-between align-items-center">
                    <div>
                      <h5 class="alert-heading"><i class="fa fa-headset me-2"></i> ¿Necesitas más información?</h5>
                      <p class="mb-md-0">Nuestro equipo de atención al cliente está disponible para resolver tus dudas.</p>
                    </div>
                    <a href="/contacto" class="btn btn-primary">
                      <i class="fa fa-envelope me-2"></i> Contactar ahora
                    </a>
                  </div>
                </div>
      
                <!-- Footer con garantía -->
                <div class="card-footer bg-light p-3">
                  <div class="d-flex align-items-center">
                    <i class="fa fa-shield-alt text-success fs-4 me-2"></i>
                    <div>
                      <strong>Garantía de 6 meses</strong>
                      <p class="mb-0 small">Todas nuestras máquinas incluyen garantía y soporte técnico.</p>
                    </div>
                  </div>
                </div>
              </div>
      
              <!-- CSS personalizado -->
              <style>
                .bg-gradient-primary {
                  background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
                }
                .hover-shadow:hover {
                  transform: translateY(-3px);
                  box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important;
                  transition: all .3s ease;
                }
                .carousel .carousel-item img {
                  transition: transform .5s ease;
                }
                .carousel:hover .carousel-item img {
                  transform: scale(1.05);
                }
              </style>
            </div>
          </div>
        </t>
      </template>
      
    
    <!-- Plantilla para subir comprobante de pago -->
    <template id="payment_upload" name="Subir Comprobante de Pago">
        <t t-call="website.layout">
            <div class="container mt-4">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/stock-maquinas">Stock de Fotocopiadoras</a></li>
                        <li class="breadcrumb-item"><a t-att-href="'/stock-maquinas/%s' % machine.id"><t t-esc="machine.name"/></a></li>
                        <li class="breadcrumb-item active" aria-current="page">Subir Comprobante</li>
                    </ol>
                </nav>
                
                <div class="card">
                    <div class="card-header bg-light">
                        <h2 class="mb-0">Subir Comprobante de Pago</h2>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h4 class="mb-3">Información de la Máquina</h4>
                                <table class="table table-sm table-bordered">
                                    <tbody>
                                        <tr>
                                            <th style="width: 40%;">Referencia:</th>
                                            <td><t t-esc="machine.name"/></td>
                                        </tr>
                                        <tr>
                                            <th>Modelo:</th>
                                            <td><t t-esc="machine.modelo_id.name"/></td>
                                        </tr>
                                        <tr>
                                            <th>Estado:</th>
                                            <td>
                                                <span t-att-class="'badge ' + (machine.state == 'reserved' and 'badge-warning' or 'badge-info')">
                                                    <t t-esc="dict(machine._fields['state'].selection).get(machine.state)"/>
                                                </span>
                                            </td>
                                        </tr>
                                        <t t-if="machine.sale_price">
                                            <tr>
                                                <th>Precio a Pagar:</th>
                                                <td class="font-weight-bold"><t t-esc="machine.sale_price"/> €</td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="col-md-6">
                                <h4 class="mb-3">Subir Comprobante</h4>
                                
                                <t t-if="error">
                                    <div class="alert alert-danger" role="alert">
                                        <t t-esc="error"/>
                                    </div>
                                </t>
                                
                                <form t-att-action="'/stock-maquinas/%s/upload_payment' % machine.id" method="post" enctype="multipart/form-data" class="mt-3">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    
                                    <div class="form-group">
                                        <label for="payment_proof">Comprobante de Pago <span class="text-danger">*</span></label>
                                        <input type="file" name="payment_proof" id="payment_proof" class="form-control" required="required"/>
                                        <small class="form-text text-muted">Formatos aceptados: PDF, JPG, PNG (Máx. 10MB)</small>
                                    </div>
                                    
                                    <div class="alert alert-info">
                                        <i class="fa fa-info-circle mr-2"></i> 
                                        <strong>Nota importante:</strong> Al subir su comprobante de pago, el estado de la máquina 
                                        cambiará automáticamente a "Vendida" y se registrará como propiedad suya.
                                    </div>
                                    
                                    <div class="form-group mt-4">
                                        <button type="submit" class="btn btn-primary btn-lg">Subir Comprobante</button>
                                        <a t-att-href="'/stock-maquinas/%s' % machine.id" class="btn btn-outline-secondary btn-lg ml-2">Cancelar</a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Plantilla de éxito al subir el pago -->
    <template id="payment_success" name="Pago Exitoso">
        <t t-call="website.layout">
            <div class="container mt-5">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card border-success">
                            <div class="card-header bg-success text-white">
                                <h3 class="mb-0"><i class="fa fa-check-circle mr-2"></i> Comprobante Recibido</h3>
                            </div>
                            <div class="card-body">
                                <h4 class="card-title">¡Gracias por su compra!</h4>
                                <p class="card-text">Su comprobante de pago para la máquina <strong><t t-esc="machine.name"/></strong> ha sido recibido correctamente y la máquina ya figura como vendida a su nombre.</p>
                                
                                <hr/>
                                
                                <h5>Detalles de la compra:</h5>
                                <ul>
                                    <li><strong>Referencia:</strong> <t t-esc="machine.name"/></li>
                                    <li><strong>Marca/Modelo:</strong> <t t-esc="machine.marca_id.name"/> <t t-esc="machine.modelo_id.name"/></li>
                                    <li><strong>Fecha de compra:</strong> <t t-esc="machine.sold_date" t-options="{'widget': 'datetime'}"/></li>
                                    <li t-if="machine.sale_price"><strong>Precio:</strong> <t t-esc="machine.sale_price"/> €</li>
                                </ul>
                                
                                <div class="text-center mt-4">
                                    <a href="/mis-maquinas" class="btn btn-primary btn-lg">Ver Mis Máquinas</a>
                                    <a href="/stock-maquinas" class="btn btn-outline-secondary btn-lg ml-2">Volver al Stock</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Plantilla cuando una máquina no está disponible -->
    <!-- Plantilla cuando una máquina no está disponible -->
<template id="machine_not_available" name="Máquina No Disponible">
    <t t-call="website.layout">
        <div class="container mt-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card border-warning">
                        <div class="card-header bg-warning text-white">
                            <h3 class="mb-0"><i class="fa fa-exclamation-triangle mr-2"></i> Máquina No Disponible</h3>
                        </div>
                        <div class="card-body">
                            <h4 class="card-title">Lo sentimos, esta máquina ya no está disponible</h4>
                            <p class="card-text">La máquina <strong><t t-esc="machine.name"/></strong> ya no se encuentra disponible para reserva.</p>
                            
                            <hr/>
                            
                            <p>El estado actual de la máquina es: 
                                <span t-att-class="'badge ' + (
                                    machine.state == 'reserved' and 'badge-warning' or 
                                    machine.state == 'pending_payment' and 'badge-info' or 
                                    machine.state == 'sold' and 'badge-secondary' or 
                                    'badge-dark')">
                                    <t t-esc="dict(machine._fields['state'].selection).get(machine.state)"/>
                                </span>
                            </p>
                            
                            <div class="text-center mt-4">
                                <a href="/stock-maquinas" class="btn btn-primary btn-lg">Ver Otras Máquinas</a>
                                <a t-att-href="'/stock-maquinas/%s' % machine.id" class="btn btn-outline-secondary btn-lg ml-2">Ver Detalles</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>
</template>
</odoo>