<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ========================================= -->
    <!-- VISTA FORMULARIO -->
    <!-- ========================================= -->
    <record id="view_whatsapp_config_form" model="ir.ui.view">
        <field name="name">whatsapp.config.form</field>
        <field name="model">whatsapp.config</field>
        <field name="arch" type="xml">
            <form string="Configuraci√≥n WhatsApp API">
                <header>
                    <button name="check_connection" 
                            string="üîå Verificar Conexi√≥n" 
                            type="object" 
                            class="oe_highlight"/>
                    <button name="action_open_qr_page" 
                            string="üì± Ver C√≥digo QR" 
                            type="object" 
                            class="oe_highlight"/>
                    <button name="action_test_notification" 
                            string="üß™ Enviar Prueba" 
                            type="object"/>
                </header>
                <sheet>
                    <widget name="web_ribbon" title="Activo" bg_color="text-bg-success" invisible="not active"/>
                    <widget name="web_ribbon" title="Inactivo" bg_color="text-bg-danger" invisible="active"/>
                    
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-archive">
                            <field name="active" widget="boolean_button" options="{'terminology': 'archive'}"/>
                        </button>
                        <button type="object" 
                                name="check_connection" 
                                class="oe_stat_button" 
                                icon="fa-plug">
                            <field name="is_connected" 
                                   widget="boolean" 
                                   options="{'terminology': {'string_true': 'Conectado', 'string_false': 'Desconectado', 'hover_true': '‚úÖ WhatsApp Conectado', 'hover_false': '‚ùå WhatsApp Desconectado'}}"/>
                        </button>
                        <button name="action_view_notifications" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-whatsapp">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="total_messages_sent" widget="integer"/>
                                </span>
                                <span class="o_stat_text">Mensajes Enviados</span>
                            </div>
                        </button>
                    </div>
                    
                    <div class="oe_title">
                        <label for="name" string="Configuraci√≥n"/>
                        <h1>
                            <field name="name" placeholder="Nombre de configuraci√≥n..."/>
                        </h1>
                    </div>
                    
                    <group>
                        <group name="connection" string="üîó Configuraci√≥n de API">
                            <field name="api_url" placeholder="http://localhost:3000"/>
                            <field name="api_key" password="True"/>
                            <field name="session_name"/>
                            <field name="sequence"/>
                        </group>
                        
                        <group name="status" string="üìä Estado de Conexi√≥n">
                            <field name="last_check" readonly="1"/>
                            <field name="connection_status" widget="text" readonly="1"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="üìà Estad√≠sticas" name="stats">
                            <group>
                                <group string="Mensajes">
                                    <field name="total_messages_sent" readonly="1"/>
                                    <field name="total_messages_failed" readonly="1"/>
                                    <field name="last_message_date" readonly="1"/>
                                </group>
                                <group string="Opciones">
                                    <field name="log_messages"/>
                                    <field name="auto_verify_numbers"/>
                                </group>
                            </group>
                            
                            <group string="üìä Informaci√≥n">
                                <div class="alert alert-info" role="alert">
                                    <p><strong>‚ÑπÔ∏è Estad√≠sticas Globales</strong></p>
                                    <ul>
                                        <li>Total enviados: <strong><field name="total_messages_sent" readonly="1" nolabel="1"/></strong></li>
                                        <li>Total fallidos: <strong><field name="total_messages_failed" readonly="1" nolabel="1"/></strong></li>
                                        <li>Tasa de √©xito: <strong>
                                            <field name="total_messages_sent" readonly="1" invisible="1"/>
                                            <field name="total_messages_failed" readonly="1" invisible="1"/>
                                        </strong></li>
                                    </ul>
                                </div>
                            </group>
                        </page>
                        
                        <page string="‚ÑπÔ∏è Informaci√≥n" name="info">
                            <group>
                                <div class="alert alert-info" role="alert">
                                    <h4>üîß Configuraci√≥n de WhatsApp API (Baileys)</h4>
                                    <p>Esta configuraci√≥n conecta Odoo con tu API de WhatsApp basada en Baileys.</p>
                                    
                                    <h5>üìã Pasos para configurar:</h5>
                                    <ol>
                                        <li>Ingresa la <strong>URL de tu API</strong> (ej: http://localhost:3000 o http://baileys-api:3000)</li>
                                        <li>Ingresa tu <strong>API Key</strong> (configurada en tu servidor Baileys)</li>
                                        <li>Click en <strong>"üîå Verificar Conexi√≥n"</strong></li>
                                        <li>Si muestra "Desconectado", click en <strong>"üì± Ver C√≥digo QR"</strong></li>
                                        <li>Escanea el c√≥digo QR desde WhatsApp en tu tel√©fono</li>
                                        <li>Verifica nuevamente la conexi√≥n</li>
                                    </ol>
                                    
                                    <h5>üß™ Probar Configuraci√≥n:</h5>
                                    <p>Una vez conectado, usa el bot√≥n <strong>"üß™ Enviar Prueba"</strong> para verificar que los mensajes se env√≠an correctamente.</p>
                                    
                                    <h5>üìù Plantillas de Mensajes:</h5>
                                    <p>Las plantillas de mensajes se configuran en: <strong>WhatsApp ‚Üí Plantillas</strong></p>
                                    <p>All√≠ podr√°s crear plantillas din√°micas para cualquier modelo de Odoo.</p>
                                </div>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- ========================================= -->
    <!-- VISTA LISTA -->
    <!-- ========================================= -->
    <record id="view_whatsapp_config_list" model="ir.ui.view">
        <field name="name">whatsapp.config.list</field>
        <field name="model">whatsapp.config</field>
        <field name="arch" type="xml">
            <list string="Configuraciones WhatsApp" default_order="sequence, id">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="api_url"/>
                <field name="is_connected" widget="boolean_toggle" readonly="1"/>
                <field name="last_check" optional="show"/>
                <field name="total_messages_sent" optional="show" sum="Total Enviados"/>
                <field name="total_messages_failed" optional="hide" sum="Total Fallidos"/>
                <field name="active" widget="boolean_toggle"/>
            </list>
        </field>
    </record>

  
    <!-- ========================================= -->
    <!-- WIZARD: MENSAJE DE PRUEBA -->
    <!-- ========================================= -->
    <record id="view_whatsapp_test_message_wizard_form" model="ir.ui.view">
        <field name="name">whatsapp.test.message.wizard.form</field>
        <field name="model">whatsapp.test.message.wizard</field>
        <field name="arch" type="xml">
            <form string="Enviar Mensaje de Prueba">
                <group>
                    <field name="config_id" invisible="1"/>
                    <field name="phone" placeholder="51987654321"/>
                    <field name="message" widget="text"/>
                </group>
                <footer>
                    <button string="üì§ Enviar" 
                            name="action_send_test" 
                            type="object" 
                            class="oe_highlight"/>
                    <button string="Cancelar" 
                            class="btn-secondary" 
                            special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- ========================================= -->
    <!-- ACCI√ìN DE VENTANA -->
    <!-- ========================================= -->
    <record id="action_whatsapp_config" model="ir.actions.act_window">
        <field name="name">WhatsApp API</field>
        <field name="res_model">whatsapp.config</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Configura la conexi√≥n con WhatsApp API
            </p>
            <p>
                Conecta tu sistema con WhatsApp (Baileys) para enviar notificaciones autom√°ticas.<br/>
                <strong>Una sola configuraci√≥n</strong> sirve para todas las plantillas de mensajes.
            </p>
        </field>
    </record>

  

</odoo>