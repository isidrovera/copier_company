<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="sticker_a7_web_template">

    <t t-call="web.html_container">
      <t t-call="web.basic_layout">

        <style>
        /* Página A4 */
        @page {
            size: A4;
            margin: 0;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        /* Grilla 2 columnas x 4 filas = 8 stickers por hoja */
        .sheet {
            display: grid;
            grid-template-columns: repeat(2, 105mm);
            grid-template-rows: repeat(4, 74mm);
            gap: 6mm;
            justify-content: center;
            margin: 5mm;
        }

        /* Sticker A7 horizontal */
        .sticker {
            width: 105mm;
            height: 74mm;

            border: 2px solid #000;
            outline: 1px solid #000;

            padding: 4mm;
            box-sizing: border-box;
            position: relative;
            background: #f9f9f4;

            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;

            page-break-inside: avoid;
            break-inside: avoid;

            /* Layout interno */
            display: grid;
            grid-template-columns: 1fr 40mm;
            gap: 4mm;
        }

        /* Columna izquierda */
        .left {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        /* LOGO — nunca se estira */
        .company-logo {
            max-height: 18mm;
            max-width: 40mm;
            width: auto;
            height: auto;
            object-fit: contain;
            margin-bottom: 3mm;
        }

        /* Texto */
        .text {
            font-size: 9px;
            margin-bottom: 3mm;
        }

        .serial {
            font-size: 10px;
            font-weight: bold;
            margin-bottom: 2mm;
        }

        .contact {
            font-size: 9px;
            margin-bottom: 1mm;
        }

        /* Columna derecha QR */
        .right {
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
        }

        .scan {
            border: 2px solid #1e293b;
            padding: 2mm;
            text-align: center;
            background: white;
        }

        .scan-title {
            background: #1e293b;
            color: white;
            font-size: 8px;
            padding: 2px;
            margin-bottom: 2px;
        }

        /* QR alta calidad, sin suavizado */
        .qr {
            width: 32mm;
            height: 32mm;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* Impresión perfecta */
        @media print {

            @page {
                size: A4;
                margin: 0;
            }

            body, .sheet {
                margin: 0;
                padding: 0;
            }

            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
        </style>

        <div class="sheet">

          <!-- Recorremos los equipos seleccionados -->
          <t t-foreach="docs" t-as="doc">

            <!-- Generar QR si no existe -->
            <t t-if="not doc.qr_code">
              <t t-set="dummy" t-value="doc.generar_qr_code()" />
            </t>

            <div class="sticker">

              <!-- COLUMNA IZQUIERDA -->
              <div class="left">

                <!-- LOGO REAL DE TU EMPRESA (sin deformar) -->
                <t t-set="company" t-value="request.env.company"/>

                <t t-if="company.logo">
                  <img
                    t-att-src="'data:image/png;base64,%s' % company.logo.decode('utf-8')"
                    class="company-logo"
                    alt="Logo Empresa"/>
                </t>

                <!-- Texto corporativo -->
                <div class="text">
                  Para soporte técnico, asistencia remota o solicitud de tóner,<br/>
                  escanee el código QR.
                </div>

                <!-- Datos del equipo -->
                <div class="serial">
                  Modelo:
                  <t t-esc="doc.name.name if doc.name else 'No especificado'"/>
                </div>

                <div class="serial">
                  Serie:
                  <t t-esc="doc.serie_id or 'No especificada'"/>
                </div>

                <!-- Contactos -->
                <div class="contact">info@copiercompanysac.com</div>
                <div class="contact">+51 975 399 303</div>
                <div class="contact">https://copiercompanysac.com</div>

              </div>

              <!-- COLUMNA DERECHA (QR) -->
              <div class="right">
                <div class="scan">
                  <div class="scan-title">ESCANEE AQUÍ</div>

                  <!-- QR en alta resolución -->
                  <t t-if="doc.qr_code">
                    <img
                      t-att-src="'data:image/png;base64,%s' % doc.qr_code.decode('utf-8')"
                      class="qr"
                      alt="QR Soporte"/>
                  </t>

                </div>
              </div>

            </div>

          </t>

        </div>

      </t>
    </t>

  </template>
</odoo>
