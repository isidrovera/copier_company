<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="sticker_a7_web_template">

    <t t-call="web.html_container">
      <t t-call="web.basic_layout">

        <style>
        /* Página A4 */
        @page {
            size: A4;
            margin: 0;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        /* Grilla 2 columnas x 4 filas = 8 stickers por hoja */
        .sheet {
            display: grid;
            grid-template-columns: repeat(2, 105mm);
            grid-template-rows: repeat(4, 74mm);
            gap: 6mm;
            justify-content: center;
            margin: 5mm;
        }

        /* Sticker A7 horizontal */
        .sticker {
            width: 105mm;
            height: 74mm;

            border: 2.5px solid #000;
            border-radius: 3mm;

            padding: 4mm;
            box-sizing: border-box;
            position: relative;
            background: transparent;

            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;

            page-break-inside: avoid;
            break-inside: avoid;

            /* Layout interno: ahora en filas */
            display: flex;
            flex-direction: column;
        }

        /* Fila superior: logo + QR */
        .top-row {
            display: grid;
            grid-template-columns: 1fr 2px 36mm;
            gap: 4mm;
            margin-bottom: 3mm;
        }

        /* Línea divisoria vertical */
        .divider {
            width: 2px;
            background: #d1d5db;
            align-self: stretch;
            border-radius: 1px;
        }

        /* Columna izquierda superior */
        .left-top {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        /* LOGO grande */
        .company-logo {
            max-height: 34mm;
            max-width: 55mm;
            width: auto;
            height: auto;
            object-fit: contain;
            margin-bottom: 2mm;
        }

        /* Datos del equipo */
        .serial {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 1.5mm;
            color: #000;
        }

        /* Columna derecha QR */
        .right-top {
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .scan {
            border: 2.5px solid #1e293b;
            border-radius: 2mm;
            padding: 2mm;
            text-align: center;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .scan-title {
            background: #1e293b;
            color: white;
            font-size: 8.5px;
            font-weight: bold;
            padding: 2px 4px;
            margin-bottom: 2mm;
            border-radius: 1mm;
            letter-spacing: 0.3px;
        }

        /* QR alta calidad */
        .qr {
            width: 30mm;
            height: 30mm;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* Fila inferior: texto + contactos */
        .bottom-row {
            display: flex;
            flex-direction: column;
        }

        /* Texto explicativo */
        .text {
            font-size: 9.5px;
            margin-bottom: 2mm;
            line-height: 1.3;
            font-weight: 500;
        }

        /* Contactos */
        .contact {
            font-size: 9.5px;
            margin-bottom: 1mm;
            font-weight: 500;
        }

        /* Impresión perfecta */
        @media print {

            @page {
                size: A4;
                margin: 0;
            }

            body, .sheet {
                margin: 0;
                padding: 0;
            }

            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
        </style>

        <div class="sheet">

          <!-- Recorremos los equipos seleccionados -->
          <t t-foreach="docs" t-as="doc">

            <!-- Generar QR si no existe -->
            <t t-if="not doc.qr_code">
              <t t-set="dummy" t-value="doc.generar_qr_code()" />
            </t>

            <div class="sticker">

              <!-- FILA SUPERIOR: LOGO + DIVISOR + QR -->
              <div class="top-row">

                <!-- Columna izquierda: Logo + Datos -->
                <div class="left-top">

                  <!-- LOGO -->
                  <t t-set="company" t-value="request.env.company"/>

                  <t t-if="company.logo">
                    <img
                      t-att-src="'data:image/png;base64,%s' % company.logo.decode('utf-8')"
                      class="company-logo"
                      alt="Logo Empresa"/>
                  </t>

                  <!-- Datos del equipo -->
                  <div class="serial">
                    Modelo:
                    <t t-esc="doc.name.name if doc.name else 'No especificado'"/>
                  </div>

                  <div class="serial">
                    Serie:
                    <t t-esc="doc.serie_id or 'No especificada'"/>
                  </div>

                </div>

                <!-- LÍNEA DIVISORIA VERTICAL -->
                <div class="divider"></div>

                <!-- Columna derecha: QR -->
                <div class="right-top">
                  <div class="scan">
                    <div class="scan-title">ESCANEE AQUÍ</div>

                    <!-- QR en alta resolución -->
                    <t t-if="doc.qr_code">
                      <img
                        t-att-src="'data:image/png;base64,%s' % doc.qr_code.decode('utf-8')"
                        class="qr"
                        alt="QR Soporte"/>
                    </t>

                  </div>
                </div>

              </div>

              <!-- FILA INFERIOR: TEXTO + CONTACTOS -->
              <div class="bottom-row">

                <!-- Texto explicativo -->
                <div class="text">
                  Para soporte técnico, asistencia remota o solicitud de tóner,<br/>
                  escanee el código QR.
                </div>

                <!-- Contactos -->
                <div class="contact">info@copiercompanysac.com</div>
                <div class="contact">+51 975 399 303</div>
                <div class="contact">https://copiercompanysac.com</div>

              </div>

            </div>

          </t>

        </div>

      </t>
    </t>

  </template>
</odoo>