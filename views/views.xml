<odoo>
  <data>
    <!-- List View -->
    <record model="ir.ui.view" id="copier_company_list_enhanced">
        <field name="name">copier.company.list.enhanced</field>
        <field name="model">copier.company</field>
        <field name="arch" type="xml">
            <list>
                <!-- Campos siempre visibles -->
                <field name="secuencia"/>
                <field name="marca_id"/>
                <field name="name"/>
                <field name="serie_id"/>
                <field name="cliente_id"/>
                <field name="sede"/>
                <field name="ubicacion"/>
                <field name="estado_maquina_id"/>
                
                <!-- Campos opcionales - Facturaci칩n -->
                <field name="tipo" optional="hide"/>
                <field name="currency_id" optional="hide"/>
                <field name="fecha_inicio_alquiler" optional="hide"/>
                <field name="fecha_fin_alquiler" optional="hide"/>
                <field name="dia_facturacion" optional="hide"/>
                
                <!-- Campos opcionales - Vol칰menes -->
                <field name="volumen_mensual_bn" optional="hide" string="Vol. Mensual B/N"/>
                <field name="volumen_mensual_color" optional="hide" string="Vol. Mensual Color"/>
                
                <!-- Campos opcionales - Costos -->
                <field name="costo_copia_bn" optional="hide" string="Costo B/N"/>
                <field name="costo_copia_color" optional="hide" string="Costo Color"/>
                
                <!-- Campos opcionales - Totales Financieros -->
                <field name="renta_mensual_bn" optional="hide" string="Renta B/N"/>
                <field name="renta_mensual_color" optional="hide" string="Renta Color"/>
                <field name="subtotal_sin_igv" optional="hide" string="Subtotal"/>
                <field name="igv" optional="hide"/>
                <field name="monto_igv" optional="hide" string="Monto IGV"/>
                <field name="descuento" optional="hide"/>
                <field name="total_facturar_mensual" optional="show" string="Total Mensual" widget="monetary"/>
                
                <!-- Campos opcionales - Estado -->
                <field name="estado_renovacion" optional="hide"/>
                <field name="duracion_alquiler_id" optional="hide" string="Duraci칩n"/>
                
                <!-- Campos opcionales - Productos -->
                <field name="producto_facturable_bn_id" optional="hide" string="Producto B/N"/>
                <field name="producto_facturable_color_id" optional="hide" string="Producto Color"/>
                
                <!-- Campo QR Code -->
                <field name="qr_code" optional="hide"/>
                
                <!-- Botones de acci칩n -->
                <button name="crear_ticket" string="Servicio" type="object" icon="fa-wrench" class="btn-primary"/>
                <button name="generar_qr_code" string="QR" type="object" icon="fa-qrcode" class="btn-info"/>
            </list>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_maquinas_form" model="ir.ui.view">
    <field name="name">copier.company.form</field>
    <field name="model">copier.company</field>
    <field name="arch" type="xml">
        <form>
            <header>
                <button name="crear_ticket" string="Crear Ticket" type="object" class="btn-primary"/>
                <button name="generar_qr_code" string="Generar QR" type="object" class="btn-info"/>
                <button name="action_print_report" string="Imprimir Cotizaci칩n" type="object" class="btn-success"/>
                <button name="enviar_correo_propuesta" string="Enviar Propuesta" type="object" class="oe_highlight"/>
                <field name="estado_renovacion" widget="statusbar" statusbar_visible="vigente,por_vencer,renovado,finalizado"/>
                <button name="debug_urgente_company" 
        string="游댌 Debug Company" 
        type="object" 
        class="btn-warning"
        help="Debug urgente para identificar discrepancia en totales"/>
                <button name="action_renovar_contrato" 
                        string="Renovar Contrato" 
                        type="object" 
                        class="oe_highlight"
                />
                <button 
                        name="send_whatsapp_report" 
                        type="object" 
                        class="btn btn-success"
                        icon="fa-whatsapp"
                        string=" Enviar por WhatsApp"                    
                        style="background-color: #25D366 !important; border-color: #25D366 !important;"
                />
                <button name="generar_sticker_corporativo" 
        string="Generar Sticker" 
        type="object" 
        class="btn-primary"
        icon="fa-qrcode"/>
                <field name="estado_maquina_id" widget="statusbar" options="{'clickable': '1'}"/>
            </header>
            <sheet>
                <div class="oe_button_box" name="button_box">
                    <button class="oe_stat_button" type="object" 
                            name="action_view_counters" icon="fa-calculator">
                        <field string="Lecturas" name="counter_count" widget="statinfo"/>
                    </button>
                </div>

                <div class="alert alert-info">
                    <strong>Instrucciones:</strong>
                    <ul>
                        <li>Complete los datos del equipo y cliente</li>
                        <li>Configure el volumen mensual esperado</li>
                        <li>Los montos se calculan autom치ticamente</li>
                        <li>Genere el c칩digo QR para servicio t칠cnico</li>
                    </ul>
                </div>

                <group>
                    <group string="Datos del Equipo">
                        <field name="secuencia" readonly="1"/>
                        <field name="marca_id" required="1"/>
                        <field name="name" required="1"/>
                        <field name="serie_id" required="1"/>
                        <field name="tipo" required="1"/>
                        <field name="accesorios_ids" widget="many2many_tags"/>
                    </group>
                    <group string="Datos del Cliente">
                        <field name="cliente_id" required="1"/>
                        <field name="tipo_identificacion"/>
                        <field name="identificacion"/>
                        <field name="sede" required="1"/>
                        <field name="ubicacion" required="1"/>
                    </group>
                </group>

                <notebook>
                    <page name="facturacion" string="Facturaci칩n">
                        <group>
                            <group string="Configuraci칩n">
                                <field name="currency_id"/>
                                <field name="payment_term_id" 
                           options="{'no_create': True, 'no_edit': True}"/>
                                <field name="fecha_inicio_alquiler" required="1"/>
                                <field name="duracion_alquiler_id" required="1"/>
                                <field name="fecha_fin_alquiler" readonly="1"/>
                                <field name="dia_facturacion"/>
                                <field name="facturacion_automatica"/>
                                <field name="producto_facturable_id" options="{'no_create': True}"/>
                                <field name="producto_facturable_bn_id" 
           required="'estado_maquina_id.name', '=', 'Alquilada'"
           string="Producto B/N"/>
                                <field name="producto_facturable_color_id" 
                                
       required="tipo == 'color' and estado_maquina_id and estado_maquina_id.name == 'Alquilada'"
       invisible="tipo == 'monocroma'"/>
                            </group>
                            <group string="Costos y Vol칰menes">
                                <!-- Los costos unitarios siempre se muestran, solo son de solo lectura cuando no es c치lculo autom치tico -->
                                <field name="costo_copia_bn" readonly="tipo_calculo != 'auto'"/>
                                <field name="costo_copia_color" invisible="tipo == 'monocroma'" readonly="tipo_calculo != 'auto'"/>
                                <field name="volumen_mensual_bn"/>
                                <field name="volumen_mensual_color" invisible="tipo == 'monocroma'"/>
                                <field name="precio_bn_incluye_igv" invisible="tipo_calculo != 'auto'"/>
                                <field name="precio_color_incluye_igv" invisible="tipo_calculo != 'auto' or tipo == 'monocroma'"/>
                            </group>
                            <group string="Configuraci칩n de C치lculo">
                                <field name="tipo_calculo" widget="radio"/>
                                
                                <!-- Campos para ingreso manual de montos, visibles seg칰n el tipo de c치lculo seleccionado -->
                                <field name="monto_mensual_bn" 
                                       invisible="tipo_calculo not in ['manual_sin_igv_bn', 'manual_con_igv_bn']" 
                                       placeholder="Ingrese el monto mensual para copias B/N"/>
                                
                                <field name="monto_mensual_color" 
                                       invisible="tipo_calculo not in ['manual_sin_igv_color', 'manual_con_igv_color'] or tipo == 'monocroma'" 
                                       placeholder="Ingrese el monto mensual para copias a color"/>
                                
                                <field name="monto_mensual_total" 
                                       invisible="tipo_calculo not in ['manual_sin_igv_total', 'manual_con_igv_total']" 
                                       placeholder="Ingrese el monto mensual total (B/N y color)"/>
                            </group>
                            <group string="Totales">
                                <field name="renta_mensual_bn" readonly="1"/>
                                <field name="renta_mensual_color" invisible="tipo == 'monocroma'" readonly="1"/>
                                <field name="subtotal_sin_igv" readonly="1"/>
                                <field name="igv"/>
                                <field name="monto_igv" readonly="1"/>
                                <field name="descuento"/>
                                <field name="total_facturar_mensual" class="oe_subtotal_footer_separator" readonly="1"/>
                            </group>
                        </group>
                    </page>
                    <page string="Historial de Renovaciones">
                        <field name="historial_renovaciones">
                            <list>
                                <field name="fecha_renovacion"/>
                                <field name="fecha_anterior"/>
                                <field name="fecha_fin_anterior"/>
                                <field name="duracion_anterior_id"/>
                                <field name="notas"/>
                            </list>
                        </field>
                    </page>
                    <page name="especificaciones" string="Especificaciones">
                        <group>
                            <group>
                                <field name="especificaciones_id"/>
                            </group>
                            <group>
                                <field name="imagen_id"/>
                                <field name="qr_code" invisible="not qr_code"/>
                            </group>
                        </group>
                    </page>
                </notebook>
            </sheet>
            <chatter />
        </form>
    </field>
</record>

 <!-- Kanban View (Odoo 17/18) -->
<record model="ir.ui.view" id="copier_company.kanban">
  <field name="name">copier_company.kanban</field>
  <field name="model">copier.company</field>
  <field name="arch" type="xml">
    <kanban default_group_by="estado_maquina_id"
            class="o_kanban_mobile"
            records_draggable="1"
            create="1" quick_create="0">

      <!-- Declarar campos usados -->
      <field name="name"/>
      <field name="marca_id"/>
      <field name="serie_id"/>
      <field name="cliente_id"/>
      <field name="sede"/>
      <field name="ubicacion"/>
      <field name="estado_maquina_id"/>
      <field name="tipo"/>
      <field name="formato"/>
      <field name="secuencia"/>

      <templates>
        <t t-name="card">
          <!-- Usar el display_name del M2O para comparar -->
          <t t-set="estado" t-value="record.estado_maquina_id.value or ''"/>

          <div class="o_kanban_record o_kanban_global_click w-100 position-relative rounded-3 shadow-sm"
               t-att-style="'background-color: ' + (
                 (estado == 'Disponible'    and 'rgba(40,167,69,0.1)')  or
                 (estado == 'En Uso'        and 'rgba(0,123,255,0.1)') or
                 (estado == 'Alquilada'     and 'rgba(255,193,7,0.1)') or
                 (estado == 'Mantenimiento' and 'rgba(220,53,69,0.1)') or
                 'rgba(108,117,125,0.1)'
               )">

            <div class="p-3">
              <!-- Header -->
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                  <h3 class="mb-0 fw-bold">
                    <field name="name"/> - <field name="secuencia"/>
                  </h3>
                  <small class="text-muted">Serie: <field name="serie_id"/></small>
                </div>
                <span class="badge rounded-pill"
                      t-att-class="{
                        'bg-success':  estado == 'Disponible',
                        'bg-primary':  estado == 'En Uso',
                        'bg-warning':  estado == 'Alquilada',
                        'bg-danger':   estado == 'Mantenimiento',
                        'bg-secondary': ['Disponible','En Uso','Alquilada','Mantenimiento'].indexOf(estado) == -1
                      }">
                  <field name="estado_maquina_id"/>
                </span>
              </div>

              <!-- Details -->
              <div class="mb-3">
                <div class="d-flex flex-column gap-2">
                  <div class="d-flex align-items-center">
                    <i class="fa fa-copyright me-2 text-muted"/>
                    <field name="marca_id"/>
                  </div>
                  <div class="d-flex align-items-center">
                    <i class="fa fa-building me-2 text-primary"/>
                    <field name="cliente_id"/>
                  </div>
                  <div class="d-flex align-items-center">
                    <i class="fa fa-map-marker me-2 text-danger"/>
                    <field name="ubicacion"/> - <field name="sede"/>
                  </div>
                  <div class="d-flex align-items-center">
                    <i class="fa fa-print me-2 text-success"/>
                    <field name="tipo"/> - <field name="formato"/>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="d-flex gap-2">
                <button name="crear_ticket" type="object" class="btn btn-primary btn-sm">
                  <i class="fa fa-wrench me-1"/> Servicio
                </button>
                <button name="generar_qr_code" type="object" class="btn btn-info btn-sm text-white">
                  <i class="fa fa-qrcode me-1"/> QR
                </button>
                <button name="enviar_correo_propuesta" type="object" class="btn btn-success btn-sm">
                  <i class="fa fa-envelope me-1"/> Email
                </button>
              </div>
            </div>
          </div>
        </t>
      </templates>
    </kanban>
  </field>
</record>

    <!-- Search View -->
    <record id="copier_company_search" model="ir.ui.view">
      <field name="name">copier.company.search</field>
      <field name="model">copier.company</field>
      <field name="arch" type="xml">
        <search>
          <field name="name"/>
          <field name="serie_id"/>
          <field name="cliente_id"/>
          <field name="sede"/>
          <separator/>
          <filter string="Disponibles" name="disponible" domain="[('estado_maquina_id.name','=','Disponible')]"/>
          <filter string="En Mantenimiento" name="mantenimiento" domain="[('estado_maquina_id.name','=','En Mantenimiento')]"/>
          <filter string="Fuera de Servicio" name="fuera_servicio" domain="[('estado_maquina_id.name','=','Fuera de Servicio')]"/>
          
        </search>
      </field>
    </record>

    
  </data>
</odoo>