<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Vista Lista: Notificaciones WhatsApp -->
    <record id="view_whatsapp_service_notification_list" model="ir.ui.view">
        <field name="name">whatsapp.service.notification.list</field>
        <field name="model">whatsapp.service.notification</field>
        <field name="arch" type="xml">
            <list string="Notificaciones WhatsApp" 
                  decoration-success="state == 'sent'"
                  decoration-danger="state == 'failed'"
                  decoration-muted="state == 'pending'">
                
                <field name="create_date" string="Fecha Creaci√≥n"/>
                <field name="service_request_id" string="Solicitud"/>
                <field name="notification_type" string="Tipo"/>
                <field name="recipient_type" string="Destinatario"/>
                <field name="phone_number" string="Tel√©fono"/>
                <field name="state" string="Estado" widget="badge"
                       decoration-success="state == 'sent'"
                       decoration-danger="state == 'failed'"
                       decoration-warning="state == 'pending'"/>
                <field name="sent_date" string="Enviado"/>
                
                <!-- ‚úÖ SIN ATTRS -->
                <button name="action_retry_send" 
                        type="object" 
                        string="Reintentar"
                        invisible="state != 'failed'"
                        icon="fa-refresh"
                        class="btn-primary"/>
            </list>
        </field>
    </record>
    
    <!-- Vista Formulario: Notificaciones WhatsApp -->
    <record id="view_whatsapp_service_notification_form" model="ir.ui.view">
        <field name="name">whatsapp.service.notification.form</field>
        <field name="model">whatsapp.service.notification</field>
        <field name="arch" type="xml">
            <form string="Notificaci√≥n WhatsApp">
                <header>
                    <field name="state" widget="statusbar" statusbar_visible="pending,sent,failed"/>
                    <!-- ‚úÖ SIN ATTRS -->
                    <button name="action_retry_send" 
                            string="Reintentar Env√≠o" 
                            type="object" 
                            class="btn-primary"
                            invisible="state != 'failed'"/>
                </header>
                
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="%(copier_company.action_copier_service_request)d"
                                type="action"
                                class="oe_stat_button"
                                icon="fa-ticket"
                                context="{'search_default_id': service_request_id}">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">Ver Solicitud</span>
                            </div>
                        </button>
                    </div>
                    
                    <group>
                        <group string="Informaci√≥n B√°sica">
                            <field name="service_request_id" readonly="1"/>
                            <field name="notification_type"/>
                            <field name="recipient_type"/>
                            <field name="phone_number"/>
                        </group>
                        
                        <group string="Estado de Env√≠o">
                            <field name="create_date" string="Fecha Creaci√≥n"/>
                            <!-- ‚úÖ SIN ATTRS -->
                            <field name="sent_date" invisible="not sent_date"/>
                            <field name="config_id" invisible="not config_id"/>
                            <field name="whatsapp_message_id" invisible="not whatsapp_message_id"/>
                        </group>
                    </group>
                    
                    <group string="Mensaje">
                        <field name="message_text" nolabel="1" widget="text"/>
                    </group>
                    
                    <!-- ‚úÖ SIN ATTRS -->
                    <group string="Error" invisible="not error_message">
                        <field name="error_message" nolabel="1" widget="text" class="text-danger"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- ========================================== -->
    <!-- PLANTILLAS DE MENSAJES WHATSAPP           -->
    <!-- ========================================== -->
    
    <!-- Vista Lista: Plantillas WhatsApp -->
    <record id="view_whatsapp_service_template_list" model="ir.ui.view">
        <field name="name">whatsapp.service.template.list</field>
        <field name="model">whatsapp.service.template</field>
        <field name="arch" type="xml">
            <list string="Plantillas de Mensajes WhatsApp" >
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="notification_type"/>
                <field name="active" widget="boolean_toggle"/>
                <field name="company_id" groups="base.group_multi_company"/>
            </list>
        </field>
    </record>
    
    <!-- Vista Formulario: Plantillas WhatsApp -->
    <record id="view_whatsapp_service_template_form" model="ir.ui.view">
        <field name="name">whatsapp.service.template.form</field>
        <field name="model">whatsapp.service.template</field>
        <field name="arch" type="xml">
            <form string="Plantilla de Mensaje WhatsApp">
                <header>
                    <button name="action_show_variables_help" 
                        string="Ver Variables Disponibles" 
                        type="object" 
                        class="btn-info"
                        icon="fa-question-circle"/>
                
                <button name="action_send_test_message" 
                        string="Enviar Mensaje de Prueba" 
                        type="object" 
                        class="btn-primary"
                        icon="fa-paper-plane"/>
                </header>
                <sheet>
                <div class="oe_button_box" name="button_box">
                    <field name="active" widget="boolean_button" options="{'terminology': 'active'}"/>
                </div>
                
                <div class="oe_title">
                    <h1>
                        <field name="name" placeholder="Nombre de la plantilla..."/>
                    </h1>
                </div>
                
                <group>
                    <group>
                        <field name="notification_type"/>
                        <field name="sequence"/>
                    </group>
                    <group>
                        <field name="company_id" groups="base.group_multi_company"/>
                    </group>
                </group>
                
                <notebook>
                    <page string="üìù Plantilla" name="template">
                        <group>
                            <div class="alert alert-info mb-3" role="alert">
                                <strong>üí° Consejo:</strong> 
                                Haz clic en "Ver Variables Disponibles" para ver todas las variables que puedes usar.
                                Las variables se escriben entre llaves: <code>{variable}</code>
                            </div>
                            
                            <field name="template_text" 
                                   nolabel="1" 
                                   widget="text" 
                                   placeholder="Escribe tu plantilla aqu√≠...

Ejemplo:
‚úÖ *SOLICITUD RECIBIDA*

Hola {contact}, hemos recibido tu solicitud.

üìã N√∫mero: {number}
üñ®Ô∏è Equipo: {equipment}
üìç Ubicaci√≥n: {location}

Nuestro equipo te contactar√° pronto.

_Gracias por tu confianza_ üôè"
                                   options="{'resizable': true}"
                                   style="min-height: 300px;"/>
                        </group>
                        
                        <div class="alert alert-success mt-3" role="alert">
                            <h5>üé® Formato WhatsApp:</h5>
                            <ul class="mb-0">
                                <li><code>*texto*</code> para <strong>negritas</strong></li>
                                <li><code>_texto_</code> para <em>cursivas</em></li>
                                <li><code>~texto~</code> para <del>tachado</del></li>
                                <li><code>```texto```</code> para c√≥digo</li>
                                <li>Usa emojis para hacer el mensaje m√°s atractivo üéâ</li>
                            </ul>
                        </div>
                    </page>
                    
                    <page string="üëÅÔ∏è Vista Preliminar" name="preview">
                        <div class="alert alert-warning mb-3" role="alert">
                            <strong>‚ÑπÔ∏è Vista Preliminar:</strong> 
                            Este es c√≥mo se ver√° tu mensaje con datos de ejemplo. 
                            Los valores reales se insertar√°n autom√°ticamente al enviar.
                        </div>
                        
                        <group>
                            <field name="preview_text" 
                                   nolabel="1" 
                                   widget="text" 
                                   readonly="1"
                                   style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6; min-height: 300px; font-family: 'Courier New', monospace; white-space: pre-wrap;"/>
                        </group>
                        
                        <div class="alert alert-info mt-3" role="alert">
                            üí° <strong>Tip:</strong> Usa el bot√≥n "Enviar Mensaje de Prueba" en la parte superior 
                            para enviar esta vista preliminar a tu WhatsApp y ver c√≥mo se ve realmente.
                        </div>
                    </page>
                </notebook>
            </sheet>
            </form>
        </field>
    </record>
    <record id="view_whatsapp_template_test_wizard_form" model="ir.ui.view">
        <field name="name">whatsapp.template.test.wizard.form</field>
        <field name="model">whatsapp.template.test.wizard</field>
        <field name="arch" type="xml">
            <form string="Enviar Mensaje de Prueba">
                <sheet>
                    <div class="alert alert-info" role="alert">
                        <strong>üì± Mensaje de Prueba</strong>
                        <p class="mb-0">
                            Env√≠a la vista preliminar de esta plantilla a tu WhatsApp para ver c√≥mo se ver√° el mensaje real.
                        </p>
                    </div>
                    
                    <group>
                        <group>
                            <field name="template_id" invisible="1"/>
                            <field name="phone" 
                                   placeholder="+51 987 654 321"
                                   widget="phone"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Mensaje">
                            <field name="template_text" 
                                   nolabel="1" 
                                   widget="text"
                                   style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; min-height: 250px; font-family: 'Courier New', monospace; white-space: pre-wrap;"/>
                        </page>
                    </notebook>
                    
                    <div class="alert alert-warning mt-3" role="alert">
                        <strong>‚ö†Ô∏è Importante:</strong>
                        <ul class="mb-0">
                            <li>Aseg√∫rate de que WhatsApp est√© conectado antes de enviar</li>
                            <li>El n√∫mero debe tener WhatsApp activo</li>
                            <li>Se usar√°n datos de ejemplo, no datos reales</li>
                        </ul>
                    </div>
                </sheet>
                
                <footer>
                    <button string="üì§ Enviar Mensaje" 
                            name="action_send_test" 
                            type="object" 
                            class="btn-primary"/>
                    <button string="Cancelar" 
                            class="btn-secondary" 
                            special="cancel"/>
                </footer>
            </form>
        </field>
    </record>
    
    <!-- ========================================== -->
    <!-- WIZARD: AYUDA DE VARIABLES -->
    <!-- ========================================== -->
    
    <record id="view_whatsapp_template_variables_wizard_form" model="ir.ui.view">
        <field name="name">whatsapp.template.variables.wizard.form</field>
        <field name="model">whatsapp.template.variables.wizard</field>
        <field name="arch" type="xml">
            <form string="Variables Disponibles">
                <sheet>
                    <field name="variables_info" nolabel="1" widget="html"/>
                </sheet>
                
                <footer>
                    <button string="Cerrar" class="btn-primary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>
    

   
    
    
</odoo>