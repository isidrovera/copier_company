<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Plantilla para el detalle de una máquina -->
    <template id="copier_detail" name="Detalle de Fotocopiadora">
        <t t-call="website.layout">
          <div class="container py-5">
            <!-- Migas de pan con iconos -->
            <nav aria-label="breadcrumb" class="mb-4">
              <ol class="breadcrumb bg-light p-3 rounded shadow-sm">
                <li class="breadcrumb-item">
                  <a href="/stock-maquinas" class="text-decoration-none">
                    <i class="fa fa-home me-1"></i> Stock de Fotocopiadoras
                  </a>
                </li>
                <li class="breadcrumb-item active fw-bold" aria-current="page">
                  <i class="fa fa-print me-1"></i> <t t-esc="machine.name"/>
                </li>
              </ol>
            </nav>
      
            <div class="card shadow border-0 overflow-hidden">
              <!-- Cabecera con degradado -->
              <div class="card-header bg-gradient-primary text-white d-flex justify-content-between align-items-center p-3">
                <h2 class="mb-0 d-flex align-items-center">
                  <i class="fa fa-copy me-2"></i> Fotocopiadora <t t-esc="machine.name"/>
                </h2>
                <span t-att-class="'badge rounded-pill fw-bold fs-6 ' + (
                      machine.state == 'available'       and 'bg-success' or
                      machine.state == 'reserved'        and 'bg-warning' or
                      machine.state == 'pending_payment' and 'bg-info'    or
                      'bg-secondary')">
                  <t t-if="machine.state == 'available'"><i class="fa fa-check-circle me-1"></i></t>
                  <t t-elif="machine.state == 'reserved'"><i class="fa fa-clock me-1"></i></t>
                  <t t-elif="machine.state == 'pending_payment'"><i class="fa fa-money-bill me-1"></i></t>
                  <t t-else=""><i class="fa fa-ban me-1"></i></t>
                  <t t-esc="dict(machine._fields['state'].selection).get(machine.state)"/>
                </span>
              </div>
      
              <!-- Cuerpo -->
              <div class="card-body p-4">
                <div class="row g-4">
                  <!-- Carrusel de imágenes mejorado -->
                  <div class="col-lg-6 mb-4">
                    <div class="card shadow-sm border-0 h-100">
                      <div class="card-body p-0">
                        <div id="machineImages" class="carousel slide" data-bs-ride="carousel">
                          <div class="carousel-inner rounded">
                            <!-- Imagen principal -->
                            <div class="carousel-item active">
                              <div class="position-relative">
                                <img t-if="machine.image"
                                  t-att-src="'data:image/png;base64,%s' % (machine.image.decode('utf-8'))"
                                  class="d-block w-100" style="height:400px;object-fit:contain;"
                                  alt="Imagen principal"/>
                                <img t-else=""
                                    t-att-src="'data:image/png;base64,%s' % machine.modelo_id.imagen"
                                    class="d-block w-100" style="height:400px;object-fit:contain;"
                                    alt="Imagen modelo"/>
                                <div class="position-absolute bottom-0 start-0 w-100 p-2 bg-dark bg-opacity-50 text-white">
                                  <small><i class="fa fa-camera me-1"></i> Imagen principal</small>
                                </div>
                              </div>
                            </div>
                            <!-- Imágenes adicionales -->
                            <t t-foreach="machine.image_ids" t-as="img">
                              <div class="carousel-item">
                                <div class="position-relative">
                                  <img t-att-src="'data:image/png;base64,%s' % (img.image.decode('utf-8'))"
                                      class="d-block w-100" style="height:400px;object-fit:contain;"
                                      t-att-alt="img.name or 'Imagen adicional'"/>
                                  <div class="position-absolute bottom-0 start-0 w-100 p-2 bg-dark bg-opacity-50 text-white">
                                    <small><i class="fa fa-camera me-1"></i> <t t-esc="img.name or 'Imagen adicional'"/></small>
                                  </div>
                                </div>
                              </div>
                            </t>
                          </div>
                          
                          <!-- Indicadores -->
                          <t t-if="machine.image_ids">
                            <div class="carousel-indicators">
                              <button type="button" data-bs-target="#machineImages" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                              <t t-foreach="machine.image_ids" t-as="img">
                                <button type="button" data-bs-target="#machineImages" t-att-data-bs-slide-to="img_index + 1" t-att-aria-label="'Slide ' + str(img_index + 2)"></button>
                              </t>
                            </div>
                            
                            <!-- Controles -->
                            <button class="carousel-control-prev" type="button"
                                    data-bs-target="#machineImages" data-bs-slide="prev">
                              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Anterior</span>
                            </button>
                            <button class="carousel-control-next" type="button"
                                    data-bs-target="#machineImages" data-bs-slide="next">
                              <span class="carousel-control-next-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Siguiente</span>
                            </button>
                          </t>
                        </div>
                      </div>
                    </div>
                  </div>
      
                  <!-- Datos principales -->
                  <div class="col-lg-6">
                    <h3 class="mb-3 d-flex align-items-center">
                      <i class="fa fa-tag me-2 text-primary"></i>
                      <t t-esc="machine.marca_id.name"/> <t t-esc="machine.modelo_id.name"/>
                    </h3>
      
                    <!-- Etiquetas -->
                    <div class="mb-4">
                      <span t-att-class="'badge rounded-pill me-2 fs-6 ' + (
                            machine.tipo == 'color' and 'bg-info' or 'bg-secondary')">
                        <i t-if="machine.tipo == 'color'" class="fa fa-palette me-1"></i>
                        <i t-else="" class="fa fa-adjust me-1"></i>
                        <t t-esc="dict(machine._fields['tipo'].selection).get(machine.tipo)"/>
                      </span>
                      <t t-if="machine.reparacion != 'none'">
                        <span t-att-class="'badge rounded-pill fs-6 ' + (
                              machine.reparacion == 'done'        and 'bg-success' or
                              machine.reparacion == 'in_progress' and 'bg-warning' or
                              'bg-danger')">
                          <i t-if="machine.reparacion == 'done'" class="fa fa-check-circle me-1"></i>
                          <i t-elif="machine.reparacion == 'in_progress'" class="fa fa-tools me-1"></i>
                          <i t-else="" class="fa fa-exclamation-triangle me-1"></i>
                          <t t-esc="dict(machine._fields['reparacion'].selection).get(machine.reparacion)"/>
                        </span>
                      </t>
                    </div>
      
                    <!-- Tabla de info con iconos -->
                    <div class="card border-0 shadow-sm mb-4">
                      <div class="card-body">
                        <table class="table table-hover mb-0">
                          <tbody>
                            <tr>
                              <th style="width:40%;">
                                <i class="fa fa-hashtag text-primary me-2"></i> Referencia:
                              </th>
                              <td class="fw-bold"><t t-esc="machine.name"/></td>
                            </tr>
                            <tr>
                              <th>
                                <i class="fa fa-barcode text-primary me-2"></i> N° de Serie:
                              </th>
                              <td><t t-esc="machine.serie"/></td>
                            </tr>
                            <tr>
                                <th>
                                  <i class="fa fa-print text-primary me-2"></i> Contómetro:
                                </th>
                                <td>
                                  <span class="badge bg-light text-dark">
                                    <t t-esc="machine.contometro"/> páginas
                                  </span>
                                </td>
                              </tr>
                              
                            <t t-if="machine.sale_price">
                              <tr>
                                <th>
                                  <i class="fa fa-euro-sign text-primary me-2"></i> Precio:
                                </th>
                                <td>
                                  <div class="d-flex align-items-center">
                                    <span class="fs-4 fw-bold text-primary">$<t t-esc="machine.sale_price"/></span>
                                    <span class="ms-2 badge bg-success">
                                      <i class="fa fa-tag me-1"></i> Oferta
                                    </span>
                                  </div>
                                </td>
                              </tr>
                            </t>
                          </tbody>
                        </table>
                      </div>
                    </div>
      
                    <!-- Acciones -->
                    <div class="mt-4">
                      <!-- Disponible: reservar -->
                      <t t-if="machine.state == 'available'">
                        <form t-att-action="'/stock-maquinas/%s/reserve' % machine.id" method="post">
                          <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                          <button type="submit" class="btn btn-success btn-lg w-100 mb-3 d-flex justify-content-center align-items-center">
                            <i class="fa fa-shopping-cart me-2"></i> Reservar Ahora
                          </button>
                        </form>
                        <div class="alert alert-info d-flex align-items-center" role="alert">
                          <i class="fa fa-info-circle me-2 fs-5"></i>
                          <div>
                            Disponibilidad inmediata. ¡Reserve ahora antes de que se agote!
                          </div>
                        </div>
                      </t>
      
                      <!-- Reservada por el mismo usuario -->
                      <t t-elif="machine.state == 'reserved' and machine.reserved_by.id == user.partner_id.id">
                        <div class="alert alert-warning d-flex" role="alert">
                          <div class="flex-shrink-0">
                            <i class="fa fa-exclamation-circle fs-2 me-3"></i>
                          </div>
                          <div>
                            <h5 class="alert-heading">¡Máquina reservada!</h5>
                            <p>Esta máquina está reservada por ti. Para completar la compra, sube el comprobante de pago.</p>
                            <a t-att-href="'/stock-maquinas/%s/payment' % machine.id"
                               class="btn btn-primary mt-2">
                              <i class="fa fa-upload me-2"></i> Subir comprobante de pago
                            </a>
                          </div>
                        </div>
                      </t>
      
                      <!-- Pendiente de pago -->
                      <t t-elif="machine.state == 'pending_payment' and machine.reserved_by.id == user.partner_id.id">
                        <div class="alert alert-info d-flex" role="alert">
                          <div class="flex-shrink-0">
                            <i class="fa fa-clock fs-2 me-3"></i>
                          </div>
                          <div>
                            <h5 class="alert-heading">¡Casi tuya!</h5>
                            <p>Estamos verificando tu pago. Si necesitas subir un nuevo comprobante, puedes hacerlo aquí.</p>
                            <a t-att-href="'/stock-maquinas/%s/payment' % machine.id"
                               class="btn btn-outline-primary mt-2">
                              <i class="fa fa-file-upload me-2"></i> Subir nuevo comprobante
                            </a>
                          </div>
                        </div>
                      </t>
      
                      <!-- Vendida -->
                      <t t-elif="machine.state == 'sold' and machine.reserved_by.id == user.partner_id.id">
                        <div class="alert alert-success d-flex" role="alert">
                          <div class="flex-shrink-0">
                            <i class="fa fa-check-circle fs-2 me-3"></i>
                          </div>
                          <div>
                            <h5 class="alert-heading">¡Compra completada!</h5>
                            <p>La fotocopiadora es tuya. Nuestro equipo se pondrá en contacto contigo para coordinar la entrega.</p>
                          </div>
                        </div>
                      </t>
      
                      <!-- No disponible -->
                      <t t-elif="machine.state != 'available'">
                        <div class="alert alert-secondary d-flex" role="alert">
                          <div class="flex-shrink-0">
                            <i class="fa fa-ban fs-2 me-3"></i>
                          </div>
                          <div>
                            <h5 class="alert-heading">No disponible</h5>
                            <p>Esta máquina no está disponible actualmente. Revisa otras opciones en nuestro catálogo.</p>
                            <a href="/stock-maquinas" class="btn btn-outline-secondary mt-2">
                              <i class="fa fa-search me-2"></i> Ver otras máquinas
                            </a>
                          </div>
                        </div>
                      </t>
                    </div>
                  </div>
                </div>
      
                <!-- Pestañas modernas -->
                <div class="card border-0 shadow-sm mt-5">
                  <div class="card-header bg-white">
                    <ul class="nav nav-tabs card-header-tabs" id="machineDetailTab" role="tablist">
                      <li class="nav-item">
                        <a class="nav-link active d-flex align-items-center" id="checklist-tab"
                           data-bs-toggle="tab" href="#checklist" role="tab"
                           aria-controls="checklist" aria-selected="true">
                           <i class="fa fa-clipboard-check me-2"></i> Estado de la Máquina
                        </a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" id="accessories-tab"
                           data-bs-toggle="tab" href="#accessories" role="tab"
                           aria-controls="accessories" aria-selected="false">
                           <i class="fa fa-puzzle-piece me-2"></i> Accesorios Incluidos
                        </a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" id="specs-tab"
                           data-bs-toggle="tab" href="#specs" role="tab"
                           aria-controls="specs" aria-selected="false">
                           <i class="fa fa-cogs me-2"></i> Especificaciones
                        </a>
                      </li>
                    </ul>
                  </div>
      
                  <!-- Contenidos de pestañas -->
                  <div class="card-body">
                    <div class="tab-content" id="machineDetailTabContent">
                      <!-- Checklist -->
                      <div class="tab-pane fade show active" id="checklist" role="tabpanel" aria-labelledby="checklist-tab">
                        <h4 class="mb-3 d-flex align-items-center">
                          <i class="fa fa-clipboard-list text-primary me-2"></i> Estado de los componentes
                        </h4>
                        <div class="table-responsive">
                          <table class="table table-hover">
                            <thead class="table-light">
                              <tr>
                                <th><i class="fa fa-cog me-1"></i> Componente</th>
                                <th><i class="fa fa-info-circle me-1"></i> Estado</th>
                                <th><i class="fa fa-comment me-1"></i> Observaciones</th>
                              </tr>
                            </thead>
                            <tbody>
                              <t t-foreach="machine.checklist_ids" t-as="check">
                                <tr>
                                  <td class="fw-bold"><t t-esc="check.name"/></td>
                                  <td>
                                    <span t-att-class="'badge rounded-pill ' + (
                                          check.state == 'good'      and 'bg-success' or
                                          check.state == 'regular'   and 'bg-warning' or
                                          check.state == 'poor'      and 'bg-danger'  or
                                          check.state == 'replaced'  and 'bg-info'    or
                                          'bg-secondary')">
                                      <t t-if="check.state == 'good'"><i class="fa fa-check me-1"></i></t>
                                      <t t-elif="check.state == 'regular'"><i class="fa fa-exclamation me-1"></i></t>
                                      <t t-elif="check.state == 'poor'"><i class="fa fa-times me-1"></i></t>
                                      <t t-elif="check.state == 'replaced'"><i class="fa fa-sync me-1"></i></t>
                                      <t t-esc="dict(check._fields['state'].selection).get(check.state)"/>
                                    </span>
                                  </td>
                                  <td><t t-esc="check.notes or '-'"/></td>
                                </tr>
                              </t>
                            </tbody>
                          </table>
                        </div>
                      </div>
      
                      <!-- Accesorios -->
                      <div class="tab-pane fade" id="accessories" role="tabpanel" aria-labelledby="accessories-tab">
                        <h4 class="mb-3 d-flex align-items-center">
                          <i class="fa fa-puzzle-piece text-primary me-2"></i> Accesorios incluidos con esta máquina
                        </h4>
                        <div class="row row-cols-1 row-cols-md-3 g-4">
                          <t t-if="not machine.accesorios_ids">
                            <div class="col-12">
                              <div class="alert alert-info d-flex align-items-center">
                                <i class="fa fa-info-circle me-2 fs-4"></i>
                                <div>Esta máquina no incluye accesorios adicionales.</div>
                              </div>
                            </div>
                          </t>
                          <t t-foreach="machine.accesorios_ids" t-as="accesorio">
                            <div class="col">
                              <div class="card h-100 border-0 shadow-sm hover-shadow">
                                <div class="card-body d-flex align-items-center">
                                  <i class="fa fa-puzzle-piece text-primary me-3 fs-3"></i>
                                  <h5 class="card-title mb-0"><t t-esc="accesorio.name"/></h5>
                                </div>
                              </div>
                            </div>
                          </t>
                        </div>
                      </div>
                      
                      <!-- Especificaciones -->
                      <div class="tab-pane fade" id="specs" role="tabpanel" aria-labelledby="specs-tab">
                        <h4 class="mb-3 d-flex align-items-center">
                          <i class="fa fa-cogs text-primary me-2"></i> Especificaciones técnicas
                        </h4>
                        <div class="row g-4">
                          <div class="col-md-6">
                            <div class="card border-0 shadow-sm h-100">
                              <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="fa fa-print me-2"></i> Características de impresión</h5>
                              </div>
                              <div class="card-body">
                                <ul class="list-group list-group-flush">
                                  <li class="list-group-item d-flex">
                                    <i class="fa fa-tachometer-alt text-primary me-2 mt-1"></i>
                                    <div>
                                      <strong>Velocidad de impresión:</strong>
                                      <p class="mb-0">30-40 ppm (estimado)</p>
                                    </div>
                                  </li>
                                  <li class="list-group-item d-flex">
                                    <i class="fa fa-expand-arrows-alt text-primary me-2 mt-1"></i>
                                    <div>
                                      <strong>Formato máximo:</strong>
                                      <p class="mb-0">A3 (estimado)</p>
                                    </div>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="card border-0 shadow-sm h-100">
                              <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="fa fa-network-wired me-2"></i> Conectividad</h5>
                              </div>
                              <div class="card-body">
                                <ul class="list-group list-group-flush">
                                  <li class="list-group-item d-flex">
                                    <i class="fa fa-wifi text-primary me-2 mt-1"></i>
                                    <div>
                                      <strong>Conexión de red:</strong>
                                      <p class="mb-0">Ethernet 10/100/1000</p>
                                    </div>
                                  </li>
                                  <li class="list-group-item d-flex">
                                    <i class="fa fa-usb text-primary me-2 mt-1"></i>
                                    <div>
                                      <strong>Conexión local:</strong>
                                      <p class="mb-0">USB 2.0/3.0</p>
                                    </div>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div> <!-- /tab-content -->
                  </div> <!-- /card-body -->
                </div> <!-- /card -->
                
                <!-- Call to action -->
                <div class="alert alert-primary mt-4 d-md-flex justify-content-between align-items-center">
                  <div>
                    <h5 class="alert-heading"><i class="fa fa-headset me-2"></i> ¿Necesitas más información?</h5>
                    <p class="mb-md-0">Nuestro equipo de atención al cliente está disponible para resolver tus dudas.</p>
                  </div>
                  <a href="/contacto" class="btn btn-primary">
                    <i class="fa fa-envelope me-2"></i> Contactar ahora
                  </a>
                </div>
                
              </div> <!-- /card-body -->
              
              <!-- Footer con garantía -->
              <div class="card-footer bg-light p-3">
                <div class="d-flex align-items-center">
                  <i class="fa fa-shield-alt text-success fs-4 me-2"></i>
                  <div>
                    <strong>Garantía de 6 meses</strong>
                    <p class="mb-0 small">Todas nuestras máquinas incluyen garantía y soporte técnico.</p>
                  </div>
                </div>
              </div>
            </div> <!-- /card -->
          </div> <!-- /container -->
          
          <!-- CSS personalizado -->
          <style>
            .bg-gradient-primary {
              background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
            }
            
            .hover-shadow:hover {
              transform: translateY(-3px);
              box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important;
              transition: all .3s ease;
            }
            
            .carousel .carousel-item img {
              transition: transform .5s ease;
            }
            
            .carousel:hover .carousel-item img {
              transform: scale(1.05);
            }
          </style>
        </t>
      </template>

</odoo>
